<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game 1 - Click Challenge</title>
    <style>
        /* General body styling */
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            background: linear-gradient(#eaf7fa, #d4e6f0);
            background-image: url('https://www.transparenttextures.com/patterns/wrinkled-paper.png');
            margin: 0;
        }

        /* Christmas themed title */
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #d32f2f;
            font-family: 'Comic Sans MS', cursive;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }

        /* User status */
        #userStatus {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
            color: #a23636;
        }

        /* Instructions section */
        #instructions {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            text-align: center;
            max-width: 600px;
            font-size: 1.2em;
            color: #333;
        }

        /* Centered game area */
        #gameArea {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid #b71c1c;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2);
        }

        /* Button styles */
        #start-btn, #click-btn {
            padding: 10px 20px;
            margin: 10px;
            font-size: 1.5em;
            cursor: pointer;
            background-color: #388e3c;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        #click-btn:disabled {
            background-color: #757575;
            cursor: not-allowed;
        }

        #start-btn:hover, #click-btn:hover:not([disabled]) {
            background-color: #2e7d32;
        }

        /* Timer and score styling */
        #timer, #score {
            font-size: 1.8em;
            margin: 15px;
            color: #1565c0;
        }

        /* Christmas Tree and Santa decoration */
        .decoration {
            position: absolute;
        }

        #tree {
            bottom: 20px;
            left: 10px;
            height: 200px;
            width: auto;
        }

        #santa {
            bottom: 20px;
            right: 10px;
            height: 200px;
            width: auto;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ„ Click Challenge - Game 1 ðŸŽ„</h1>
    
    <!-- Game instructions -->
    <div id="instructions">
        <p>Welcome to the Click Challenge! Try to click the button as many times as you can within 10 seconds. Your high score will be recorded if it's among your top scores for this game!</p>
        <p>Click 'Start Game' to begin, then press 'Click Me!' repeatedly until time runs out.</p>
    </div>

    <div id="userStatus"></div>
    <div id="gameArea">
        <button id="start-btn">Start Game</button>
        <button id="click-btn" disabled>Click Me!</button>
        <div id="timer">Time Left: 10s</div>
        <div id="score">Current Score: 0</div>
    </div>

    <!-- Christmas Tree and Santa Images -->
    <img id="tree" class="decoration" src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Christmas_tree_illustration.svg" alt="Christmas Tree">
    <img id="santa" class="decoration" src="https://upload.wikimedia.org/wikipedia/commons/3/3a/Santa_Claus_Icon.svg" alt="Santa Claus">

    <script defer type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4bjg7lVwd8FU8MREaPhBsBENv5qmiYYM",
            authDomain: "calendrier-de-l-avent-54e3a.firebaseapp.com",
            databaseURL: "https://calendrier-de-l-avent-54e3a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "calendrier-de-l-avent-54e3a",
            storageBucket: "calendrier-de-l-avent-54e3a.appspot.com",
            messagingSenderId: "850639567855",
            appId: "1:850639567855:web:0d799a1ecca005fcff141a",
            measurementId: "G-PC1W7RYVEH"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = '';
        let clickCount = 0;
        let playCount = 0;
        let totalPlayCountGame1 = 0;
        let highestScore = 0;

        const startBtn = document.getElementById('start-btn');
        const clickBtn = document.getElementById('click-btn');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score');

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('userStatus').innerText = `Logged in as: ${user.email}`;

                const userRef = doc(db, 'users', userId);
                const docSnap = await getDoc(userRef);

                if (!docSnap.exists()) {
                    await setDoc(userRef, { userId: userId, totalPlayCountGame1: 0, highestScoreGame1: 0 });
                } else {
                    const userData = docSnap.data();
                    totalPlayCountGame1 = userData.totalPlayCountGame1 || 0;
                    highestScore = userData.highestScoreGame1 || 0;
                    playCount = totalPlayCountGame1 + 1;
                }
            } else {
                window.location.href = 'login.html';
            }
        });

        startBtn.addEventListener('click', async () => {
            clickCount = 0;
            scoreDisplay.innerText = `Current Score: ${clickCount}`;
            playCount = totalPlayCountGame1 + 1;

            clickBtn.disabled = false;
            let timeLeft = 10;
            timerDisplay.innerText = `Time Left: ${timeLeft}s`;
            const timer = setInterval(() => {
                timeLeft -= 1;
                timerDisplay.innerText = `Time Left: ${timeLeft}s`;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    clickBtn.disabled = true;
                    saveScore(clickCount);
                }
            }, 1000);

            totalPlayCountGame1 += 1;
            await updateDoc(doc(db, 'users', userId), { totalPlayCountGame1: totalPlayCountGame1 });
        });

        clickBtn.addEventListener('click', () => {
            clickCount += 1;
            scoreDisplay.innerText = `Current Score: ${clickCount}`;
        });

        async function saveScore(score) {
            try {
                const gameData = { score: score, playCount: playCount, timestamp: new Date() };
                await addDoc(collection(db, 'users', userId, 'Game1'), gameData);

                const userRef = doc(db, 'users', userId);
                if (totalPlayCountGame1 <= 4 && score > highestScore) {
                    highestScore = score;
                    await updateDoc(userRef, { highestScoreGame1: highestScore });
                }
            } catch (error) {
                console.error("Error saving score:", error);
            }
        }
    </script>
</body>
</html>

