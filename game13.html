<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçøT'as la ref ou t'as pas la ref ? - Jeu 13 üçø</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: #ffebcd;
            background-image: url('https://www.transparenttextures.com/patterns/snow.png');
            margin: 0;
        }
        /* Christmas themed title */
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #d32f2f;
            font-family: 'Comic Sans MS', cursive;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }
        #userStatus {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
        }
                
        /* Instructions section */
        #instructions {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            text-align: center;
            max-width: 1000px;
            font-size: 1.2em;
            color: #333;
            overflow-y: auto;  /* Added for scrolling if needed */
            max-height: 300px; /* Set a maximum height */
        }
        #gameArea {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
        }
        #start-btn {
            padding: 10px 20px;
            margin: 10px;
            font-size: 1.5em;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            border: none;
        }
        #start-btn:hover {
            background-color: #0056b3;
        }

        #next-question-btn {
    padding: 10px 20px;
    margin: 10px;
    font-size: 1.5em;
    cursor: pointer;
    background-color: #007BFF;
    color: white;
    border: none;
    display: none; /* Keeps it hidden initially */
}

#next-question-btn:hover {
    background-color: #0056b3;
}
        
        #question {
            font-size: 1.5em;
            margin: 20px;
        }

        #timer, #score {
            font-size: 1.5em;
            margin: 10px;
        }
        #input {
            padding: 20px;
            font-size: 1.5em;
            margin: 10px;
            width: 300px;
        }
      
      

    </style>
</head>
<body>

    <h1>üçøT'as la ref ou t'as pas la ref ? - Jeu 13 üçø</h1>
    <div id="userStatus"></div>
    
 <!-- Game instructions -->
    <div id="instructions">
        <p>Fier comme un paon, Dudley paradait autour de ses camarades, savourant chaque victoire comme si elle scellait son statut de "patron" incontest√©. Les jeux de l‚Äô√©t√© l‚Äôavaient marqu√©, for√ßant chacun √† reconna√Ætre ses talents d‚Äôexpert en drapeaux, de pro du Rubik‚Äôs Cube et, bien s√ªr, de ma√Ætre en d√©fis improbables comme chanter "Je vous souhaite tout le bonheur du monde" ou supporter sto√Øquement des fourmis sur sa main. </p>
  <p>B√©b√© Romain, qui n‚Äôavait pas encore dig√©r√© sa confusion entre les drapeaux de la C√¥te d‚ÄôIvoire et de l‚ÄôIrlande, bouillonnait de frustration. Les moqueries de Dudley, bien que famili√®res √† coups de ¬´ T‚Äôes b√™teuuuh ¬ª , √©taient toujours redoutablement efficaces. Pour calmer son √©nervement, il prit trois d√©s, esp√©rant un petit coup de chance pour apaiser son ego. Mais m√™me l√†, la chance lui √©chappa : et quelques minutes plus tard, ce dernier s‚Äô√©cria ¬´ Attention au rhino ! ¬ª avant de s‚Äôeffondrer la t√™te la premi√®re dans le canap√©, sous les rires √©touff√©s de ses compagnons.</p>
  <p>Ses talents de d√©duction, ses r√©flexes et maintenant sa chance mis √† mal, B√©b√© Romain d√©cida de riposter sur un autre terrain. En scrutant la t√©l√©vision du salon, une id√©e commen√ßa √† germer. √Ä cette √©poque, il avait pass√© des heures √† se gaver de s√©ries comme Lie to Me, Person of Interest, Robin Hood, et The Mentalist. Si Dudley dominait sur les drapeaux, il lui restait, √† lui, le cin√©ma et les s√©ries, sa vraie force.</p>
  <p>Sans oublier son coup de ma√Ætre l√©gendaire : la fois o√π il avait trouv√© le califat omeyyade lors d‚Äôun quiz, son "banger" personnel, une prouesse qu'il n‚Äô√©voquait qu'avec un calme feint pour cacher son enthousiasme int√©rieur. ¬´ Tkt, je g√®re, ¬ª s'√©tait-il dit en se for√ßant √† rester impassible sous les regards √©bahis.</p>
  <p>Sortant de ses pens√©es, il se tourna vers Topapa, inspir√©. ¬´ Bon, Topapa, j‚Äôai une id√©e de Kahoot √† te soumettre, ¬ª d√©clara-t-il avec un sourire en coin.</p>
  <p>"Un Kahoot sp√©cial dessin anim√© !"</p>
  <p>Explication du jeu : Une description, une r√©plique, ou juste une petite r√©f√©rence. √Ä partir de cela, vous devez deviner le dessin anim√© correspondant. Attention, vous n‚Äôavez qu‚Äôun seul essai !</p>
  <p>Petites r√®gles sur la syntaxe : Pas d‚Äôaccents dans la r√©ponse, si c‚Äôest une saga de films (comme Star Wars), inutile de pr√©ciser le num√©ro et les majuscules ne sont pas n√©cessaires (mais accept√©es). Les noms des films sont les noms connus en France (exemple : Lord of the rings devient ¬´ le seigneur des anneaux ¬ª mais ¬´ Your Name ¬ª ne devient pas ¬´ Ton Pr√©nom ¬ª). Filmez-vous ! Si une r√©ponse est correcte mais rejet√©e √† cause d'un caract√®re manquant ou d‚Äôun espace en trop, je pourrai ajuster votre score pour r√©parer cette injustice. Vous n‚Äôavez qu‚Äôune tentative pour battre votre meilleur score au quiz.
</p>
    </div>
    
    <div id="gameArea">
        <button id="start-btn">üéÖStart GameüéÖ</button>
        <div id="timer"></div>
        <div id="score"></div>
        <button id="next-question-btn" style="display: none;">Prochaine question</button>
        <div id="question"></div>
        <input type="text" id="input" placeholder="R√©ponse" disabled>
      

      
    </div>

    <script defer type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4bjg7lVwd8FU8MREaPhBsBENv5qmiYYM",
            authDomain: "calendrier-de-l-avent-54e3a.firebaseapp.com",
            databaseURL: "https://calendrier-de-l-avent-54e3a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "calendrier-de-l-avent-54e3a",
            storageBucket: "calendrier-de-l-avent-54e3a.appspot.com",
            messagingSenderId: "850639567855",
            appId: "1:850639567855:web:0d799a1ecca005fcff141a",
            measurementId: "G-PC1W7RYVEH"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = '';
        let score = 0;
        let playCount = 0;
        let totalPlayCountGame13 = 0;
        let highestScore = 0;
        let questionIndex = 0;
        let timer; 

        const startBtn = document.getElementById('start-btn');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score');
        const questionDisplay = document.getElementById('question');
        const inputField = document.getElementById('input');
        const nextquestionbtn = document.getElementById('next-question-btn');


        const questions = [
            {
                 question: "Une filette d√©couvre ses parents transform√©s en cochon. Et apr√®s tous les enfants du cin√© en sont traumatis√©s",
                answer: ["Le voyage de Chihiro" , "Spirited away"], 
            },{
                 question: `<p>Somebody once told me<br>
                    The world is gonna roll me<br>
                    I ain't the sharpest tool in the shed<br>
                    She was looking kind of dumb<br>
                    With her finger and her thumb<br>
                    In the shape of an 'L' on her forehead</p>`,
                answer: ["Shrek"], 
            },
            {
                 question: "C‚Äôest l‚Äôhistoire d‚Äôun enfant qui voulait √™tre un √©norme l√¢cheur pour sa famille. Mais √† la fin du dessin anim√©, il a compris que ce n‚Äô√©tait pas bien d‚Äô√™tre un l√¢cheur. ",
                answer: ["Coco"], 
            },{
                 question: "Comment on appelle une chamelle √† 3 bosses ? ¬´ Enceinte ¬ª",
                answer: ["Zootopie", "Zootopia"], 
            },{
                 question: "C‚Äôest l‚Äòhistoire d‚Äôun pigeon qui voulait √™tre le paaaaaaaatrrroooon",
                answer: ["Cigognes et compagnie", "Cigogne et compagnie","Cigognes et cie","Cigogne et cie","Cigognes & cie","Cigogne & Cie"], 
            },{
                 question: "Chuis pas ah ah si m√©chant, jfais juste qui me vient naturellement",
                answer: ["Le Lorax", "Lorax"], 
            },{
                 question: "Pas de cape",
                answer: ["Les Indestructibles", "Indestructibles"], 
            },{
                 question: " <p> Disgr√¢ce inf√¢me<br>Parfum d'inf√¢me<br>Qui inonde mon √¢me<br>Oh, √ßa pue le drame<br>Je d√©clenche une temp√™te<br>Piti√©, arr√™te<br>√Ä chaque fois que je...</p>",
                answer: ["Roi Lion", "Le roi lion", "Lion King"], 
            },{
                 question: "Liste des protagonistes : Marie, Toulouse, Berlioz, Duchesse, Edgar, Thomas",
                answer: ["Les aristochats", "Aristochats", "Aristocats"], 
            },{
                 question: "Des schtroumpfs jaunes traversent les √©poques en essayant de proposer leur service mais ne font que causer des calamit√©s. ",
                answer: ["Les minions", "Minions"], 
            },{
                 question: "O√π je suis ? Qu'est qu'il c'est pass√© ? C'est bizarre c'√©tait moins douillet. Alors C'est √ßa le monde ? J'pr√©f√©r√© avant... C'est dr√¥le le papier peint √† changer. Ce monde est bien √©trange. J'ai faim J'ai froid Je veux qu'on m'change ! Ce monde est tout nouveau pour moi !",
                answer: ["Les Razmoket", "Les Razmokets", "Les Razmocket", "Les Razmockets", "Razmocket", "Razmockets", "Razmoket", "Razmokets"], 
            },{
                 question: "Le crocheeeeetttt",
                answer: ["Toy Story"], 
            },{
                 question: "Maxi outil, Maxi outil, Maxi outil magique. ‚Ä¶ C‚Äôest un outil surprise qui nous servira plus tard. ",
                answer: ["La maison de mickey"], 
            },{
                 question: "Un serpent du nom de Triste Sire. ",
                answer: ["Robin des Bois", "Robin Hood"], 
            },{
                 question: "L'histoire se d√©roule √† New York dans les ann√©es 1980. Un petit chaton abandonn√©, apr√®s avoir pass√© une nuit sous la pluie, tente de voler des saucisses √† un vendeur ambulant qui repousse violemment le pauvre chaton affam√©. Le chaton rencontre alors Roublard, un chien errant qui propose de faire √©quipe afin de r√©cup√©rer les saucisses. Le plan de Roublard fonctionne mais une fois les saucisses en sa possession, il fuit √† travers la ville sans partager son butin avec son co√©quipier. Le chaton suit Roublard jusqu'√† sa destination: une p√©niche d√©labr√©e amarr√©e aux docks. Alors que le chaton tente de regarder ce qui se passe √† l'int√©rieur depuis le plafond, le plancher c√®de et il tombe au milieu d'une meute de chiens compos√© de Roublard et ses amis, le chihuahua Tito, le dogue allemand Einstein, le bouledogue intellectuel Francis et la levrette persane affectueuse Rita. ",
                answer: ["Oliver et compagnie", "Oliver & Cie", "Oliver & Compagnie" , " Oliver et Cie"], 
            },{
                 question: "<p>Comme un homme <br>Sois plus violent <br>que le cours du torrent<br>Comme un homme <br>Sois plus puissant que les ouragans <br>Comme un homme<br>Sois plus ardent que le feu des volcans</p>",
                answer: ["Mulan"], 
            },{
                 question: "La sc√®ne mythique se joue √† l‚Äôarri√®re d‚Äôun restaurant italien quand les deux amoureux se retrouvent autour d‚Äôun seul plat de spaghetti. ",
                answer: ["La belle et le clochard"], 
            },{
                 question: "Un renard et un chien sont les meilleurs amis du monde. Mais leur relaion change quand le maitre du chien l‚Äôapprend √† chasser. ",
                answer: ["Rox et rouky", "Rox et Rooky", "Rox et Roucky", "Rox et Roocky"], 
            },{
                 question: "L‚Äôextinction des dodos est expliqu√©e dans ce dessin anim√©",
                answer: ["L'age de glace", "L'√¢ge de glace", "Age de glace", "√¢ge de glace", "Ice age"], 
            },{
                 question: "Un petit dessin anim√© en p√¢te √† modeler qui met en avant un personne habill√© √† la brittanique connu pour son amour du fromage et un chien tr√®s intelligent",
                answer: ["Wallace et Gromit"], 
            }
            
        ];

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('userStatus').innerText = `Welcome: ${user.email}`;

                const userRef = doc(db, 'users', userId);
                const docSnap = await getDoc(userRef);

                if (!docSnap.exists()) {
                    await setDoc(userRef, { userId: userId, totalPlayCountGame13: 0, highestScoreGame13: 0 });
                    console.log("User document created with initial values.");
                } else {
                    const userData = docSnap.data();
                    totalPlayCountGame13 = userData.totalPlayCountGame13 || 0;
                    highestScore = userData.highestScoreGame13 || 0;
                    playCount = totalPlayCountGame13 + 1;
                    console.log(`Loaded totalPlayCountGame13: ${totalPlayCountGame13}, highestScore: ${highestScore}`);
                }
            } else {
                window.location.href = 'login.html';
            }
        });

startBtn.addEventListener('click', async () => {
    score = 0;
    scoreDisplay.innerText = `Current Score: ${score}`;
    inputField.value = '';
    inputField.disabled = false;
    timerDisplay.innerText = '';

    // Increment totalPlayCount and update Firestore
    totalPlayCountGame13 += 1;
    await updateDoc(doc(db, 'users', userId), { totalPlayCountGame13: totalPlayCountGame13 });

    questionIndex = 0;
    showQuestion(questionIndex);

    timer = startTimer(); // Start the timer for the first question

    inputField.addEventListener('keyup', (event) => {
        if (event.key === 'Enter' && inputField.value) {
            clearInterval(timer); // Clear the current timer
            checkAnswer(questionIndex, inputField.value.toUpperCase());
            inputField.value = '';

        }
    });
});
document.getElementById('next-question-btn').addEventListener('click', () => {
    questionIndex++;
    if (questionIndex < questions.length) {
        showQuestion(questionIndex);
        startTimer();
        document.getElementById('next-question-btn').style.display = 'none'; // Hide the button again
    } else {
        endGame();
    }
});
      
function startTimer() {
    let timeLeft = 60; // Set time left for each question
    timerDisplay.innerText = `Temps restant: ${timeLeft}s`;

    clearInterval(timer);
    timer = setInterval(() => {
        timeLeft -= 1;
        timerDisplay.innerText = `Temps restant: ${timeLeft}s`;

        if (timeLeft <= 0) {
            clearInterval(timer);
            inputField.disabled = true; // Disable input after time runs out
            checkAnswer(questionIndex, ''); // Check answer as incorrect if time is up
           document.getElementById('next-question-btn').style.display = 'inline'; // Show "Next Question" button
            
        }
    }, 1000);

    return timer; // Return timer reference for clearing if needed
}


function showQuestion(index) {
    clearInterval(timer);
    const question = questions[index];
    questionDisplay.innerText = question.question;
    timerDisplay.innerText = `Temps restant : 60s`;
    inputField.disabled = false;
    inputField.focus();
    timer = startTimer();
}

        function checkAnswer(index, userAnswer) {
            const correctAnswers = questions[index].answer;
            userAnswer = userAnswer.trim().toLowerCase();
            
             if (correctAnswers.some(answer => answer.toLowerCase() === userAnswer)) {
                score += 5;
                scoreDisplay.innerText = `Score actuel: ${score}`;
                console.log("Correct Answer!");
            } else if (userAnswer !== '') {
                console.log("Incorrect Answer.");
            }
          questionDisplay.innerHTML += `<br><strong>R√©ponse correcte : ${correctAnswers.join(', ')}</strong>`;
          inputField.disabled = true;
          document.getElementById('next-question-btn').style.display = 'inline'; // Show "Next Question" button
        }

        async function saveScore(score) {
            try {
                const gameData = { score: score, playCount: playCount, timestamp: new Date() };
                await addDoc(collection(db, 'users', userId, 'Game13'), gameData);

                const userRef = doc(db, 'users', userId);
                if (totalPlayCountGame13 <= 1 &&score > highestScore) {
                    highestScore = score;
                    await updateDoc(userRef, { highestScoreGame13: highestScore });
                }
                console.log("Score saved successfully.");
            } catch (error) {
                console.error("Error saving score:", error);
            }
        }

        async function endGame() {
            inputField.disabled = true;
            await saveScore(score); // Save the score at the end of the game
            console.log("Game Over. Final Score:", score);
            alert(`Le quiz est fini! Wow t'avais vraiment pas la ref! Ton score final est: ${score}`);
        }
    </script>
</body>
</html>
