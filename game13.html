<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🍿T'as la ref ou t'as pas la ref ? - Jeu 13 🍿</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: #ffebcd;
            background-image: url('https://www.transparenttextures.com/patterns/snow.png');
            margin: 0;
        }
        /* Christmas themed title */
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #d32f2f;
            font-family: 'Comic Sans MS', cursive;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }
        #userStatus {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
        }
                
        /* Instructions section */
        #instructions {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            text-align: center;
            max-width: 1000px;
            font-size: 1.2em;
            color: #333;
            overflow-y: auto;  /* Added for scrolling if needed */
            max-height: 300px; /* Set a maximum height */
        }
        #gameArea {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
        }
        #start-btn {
            padding: 10px 20px;
            margin: 10px;
            font-size: 1.5em;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            border: none;
        }
        #start-btn:hover {
            background-color: #0056b3;
        }

        #next-question-btn {
    padding: 10px 20px;
    margin: 10px;
    font-size: 1.5em;
    cursor: pointer;
    background-color: #007BFF;
    color: white;
    border: none;
    display: none; /* Keeps it hidden initially */
}

#next-question-btn:hover {
    background-color: #0056b3;
}
        
        #question {
            font-size: 1.5em;
            margin: 20px;
        }

        #timer, #score {
            font-size: 1.5em;
            margin: 10px;
        }
        #input {
            padding: 20px;
            font-size: 1.5em;
            margin: 10px;
            width: 300px;
        }
      
      

    </style>
</head>
<body>

    <h1>🍿T'as la ref ou t'as pas la ref ? - Jeu 13 🍿</h1>
    <div id="userStatus"></div>
    
 <!-- Game instructions -->
    <div id="instructions">
        <p>Fier comme un paon, Dudley paradait autour de ses camarades, savourant chaque victoire comme si elle scellait son statut de "patron" incontesté. Les jeux de l’été l’avaient marqué, forçant chacun à reconnaître ses talents d’expert en drapeaux, de pro du Rubik’s Cube et, bien sûr, de maître en défis improbables comme chanter "Je vous souhaite tout le bonheur du monde" ou supporter stoïquement des fourmis sur sa main. </p>
  <p>Bébé Romain, qui n’avait pas encore digéré sa confusion entre les drapeaux de la Côte d’Ivoire et de l’Irlande, bouillonnait de frustration. Les moqueries de Dudley, bien que familières à coups de « T’es bêteuuuh » , étaient toujours redoutablement efficaces. Pour calmer son énervement, il prit trois dés, espérant un petit coup de chance pour apaiser son ego. Mais même là, la chance lui échappa : et quelques minutes plus tard, ce dernier s’écria « Attention au rhino ! » avant de s’effondrer la tête la première dans le canapé, sous les rires étouffés de ses compagnons.</p>
  <p>Ses talents de déduction, ses réflexes et maintenant sa chance mis à mal, Bébé Romain décida de riposter sur un autre terrain. En scrutant la télévision du salon, une idée commença à germer. À cette époque, il avait passé des heures à se gaver de séries comme Lie to Me, Person of Interest, Robin Hood, et The Mentalist. Si Dudley dominait sur les drapeaux, il lui restait, à lui, le cinéma et les séries, sa vraie force.</p>
  <p>Sans oublier son coup de maître légendaire : la fois où il avait trouvé le califat omeyyade lors d’un quiz, son "banger" personnel, une prouesse qu'il n’évoquait qu'avec un calme feint pour cacher son enthousiasme intérieur. « Tkt, je gère, » s'était-il dit en se forçant à rester impassible sous les regards ébahis.</p>
  <p>Sortant de ses pensées, il se tourna vers Topapa, inspiré. « Bon, Topapa, j’ai une idée de Kahoot à te soumettre, » déclara-t-il avec un sourire en coin.</p>
  <p>"Un Kahoot spécial dessin animé !"</p>
  <p>Explication du jeu : Une description, une réplique, ou juste une petite référence. À partir de cela, vous devez deviner le dessin animé correspondant. Attention, vous n’avez qu’un seul essai !</p>
  <p>Petites règles sur la syntaxe : Pas d’accents dans la réponse, si c’est une saga de films (comme Star Wars), inutile de préciser le numéro et les majuscules ne sont pas nécessaires (mais acceptées). Les noms des films sont les noms connus en France (exemple : Lord of the rings devient « le seigneur des anneaux » mais « Your Name » ne devient pas « Ton Prénom »). Filmez-vous ! Si une réponse est correcte mais rejetée à cause d'un caractère manquant ou d’un espace en trop, je pourrai ajuster votre score pour réparer cette injustice. Vous n’avez qu’une tentative pour battre votre meilleur score au quiz.
</p>
    </div>
    
    <div id="gameArea">
        <button id="start-btn">🎅Start Game🎅</button>
        <div id="timer"></div>
        <div id="score"></div>
        <button id="next-question-btn" style="display: none;">Prochaine question</button>
        <div id="question"></div>
        <input type="text" id="input" placeholder="Réponse" disabled>
      

      
    </div>

    <script defer type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4bjg7lVwd8FU8MREaPhBsBENv5qmiYYM",
            authDomain: "calendrier-de-l-avent-54e3a.firebaseapp.com",
            databaseURL: "https://calendrier-de-l-avent-54e3a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "calendrier-de-l-avent-54e3a",
            storageBucket: "calendrier-de-l-avent-54e3a.appspot.com",
            messagingSenderId: "850639567855",
            appId: "1:850639567855:web:0d799a1ecca005fcff141a",
            measurementId: "G-PC1W7RYVEH"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = '';
        let score = 0;
        let playCount = 0;
        let totalPlayCountGame13 = 0;
        let highestScore = 0;
        let questionIndex = 0;
        let timer; 

        const startBtn = document.getElementById('start-btn');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score');
        const questionDisplay = document.getElementById('question');
        const inputField = document.getElementById('input');
        const nextquestionbtn = document.getElementById('next-question-btn');


        const questions = [
            {
                 question: "Une filette découvre ses parents transformés en cochon. Et après tous les enfants du ciné en sont traumatisés",
                answer: ["Le voyage de Chihiro" , "Spirited away"], 
            },{
                 question: `<p>Somebody once told me<br>
                    The world is gonna roll me<br>
                    I ain't the sharpest tool in the shed<br>
                    She was looking kind of dumb<br>
                    With her finger and her thumb<br>
                    In the shape of an 'L' on her forehead</p>`,
                answer: ["Shrek"], 
            },
            {
                 question: "C’est l’histoire d’un enfant qui voulait être un énorme lâcheur pour sa famille. Mais à la fin du dessin animé, il a compris que ce n’était pas bien d’être un lâcheur. ",
                answer: ["Coco"], 
            },{
                 question: "Comment on appelle une chamelle à 3 bosses ? « Enceinte »",
                answer: ["Zootopie", "Zootopia"], 
            },{
                 question: "C’est l‘histoire d’un pigeon qui voulait être le paaaaaaaatrrroooon",
                answer: ["Cigognes et compagnie", "Cigogne et compagnie","Cigognes et cie","Cigogne et cie","Cigognes & cie","Cigogne & Cie"], 
            },{
                 question: "Chuis pas ah ah si méchant, jfais juste qui me vient naturellement",
                answer: ["Le Lorax", "Lorax"], 
            },{
                 question: "Pas de cape",
                answer: ["Les Indestructibles", "Indestructibles"], 
            },{
                 question: " <p> Disgrâce infâme<br>Parfum d'infâme<br>Qui inonde mon âme<br>Oh, ça pue le drame<br>Je déclenche une tempête<br>Pitié, arrête<br>À chaque fois que je...</p>",
                answer: ["Roi Lion", "Le roi lion", "Lion King"], 
            },{
                 question: "Liste des protagonistes : Marie, Toulouse, Berlioz, Duchesse, Edgar, Thomas",
                answer: ["Les aristochats", "Aristochats", "Aristocats"], 
            },{
                 question: "Des schtroumpfs jaunes traversent les époques en essayant de proposer leur service mais ne font que causer des calamités. ",
                answer: ["Les minions", "Minions"], 
            },{
                 question: "Où je suis ? Qu'est qu'il c'est passé ? C'est bizarre c'était moins douillet. Alors C'est ça le monde ? J'préféré avant... C'est drôle le papier peint à changer. Ce monde est bien étrange. J'ai faim J'ai froid Je veux qu'on m'change ! Ce monde est tout nouveau pour moi !",
                answer: ["Les Razmoket", "Les Razmokets", "Les Razmocket", "Les Razmockets", "Razmocket", "Razmockets", "Razmoket", "Razmokets"], 
            },{
                 question: "Le crocheeeeetttt",
                answer: ["Toy Story"], 
            },{
                 question: "Maxi outil, Maxi outil, Maxi outil magique. … C’est un outil surprise qui nous servira plus tard. ",
                answer: ["La maison de mickey"], 
            },{
                 question: "Un serpent du nom de Triste Sire. ",
                answer: ["Robin des Bois", "Robin Hood"], 
            },{
                 question: "L'histoire se déroule à New York dans les années 1980. Un petit chaton abandonné, après avoir passé une nuit sous la pluie, tente de voler des saucisses à un vendeur ambulant qui repousse violemment le pauvre chaton affamé. Le chaton rencontre alors Roublard, un chien errant qui propose de faire équipe afin de récupérer les saucisses. Le plan de Roublard fonctionne mais une fois les saucisses en sa possession, il fuit à travers la ville sans partager son butin avec son coéquipier. Le chaton suit Roublard jusqu'à sa destination: une péniche délabrée amarrée aux docks. Alors que le chaton tente de regarder ce qui se passe à l'intérieur depuis le plafond, le plancher cède et il tombe au milieu d'une meute de chiens composé de Roublard et ses amis, le chihuahua Tito, le dogue allemand Einstein, le bouledogue intellectuel Francis et la levrette persane affectueuse Rita. ",
                answer: ["Oliver et compagnie", "Oliver & Cie", "Oliver & Compagnie" , " Oliver et Cie"], 
            },{
                 question: "<p>Comme un homme <br>Sois plus violent <br>que le cours du torrent<br>Comme un homme <br>Sois plus puissant que les ouragans <br>Comme un homme<br>Sois plus ardent que le feu des volcans</p>",
                answer: ["Mulan"], 
            },{
                 question: "La scène mythique se joue à l’arrière d’un restaurant italien quand les deux amoureux se retrouvent autour d’un seul plat de spaghetti. ",
                answer: ["La belle et le clochard"], 
            },{
                 question: "Un renard et un chien sont les meilleurs amis du monde. Mais leur relaion change quand le maitre du chien l’apprend à chasser. ",
                answer: ["Rox et rouky", "Rox et Rooky", "Rox et Roucky", "Rox et Roocky"], 
            },{
                 question: "L’extinction des dodos est expliquée dans ce dessin animé",
                answer: ["L'age de glace", "L'âge de glace", "Age de glace", "âge de glace", "Ice age"], 
            },{
                 question: "Un petit dessin animé en pâte à modeler qui met en avant un personne habillé à la brittanique connu pour son amour du fromage et un chien très intelligent",
                answer: ["Wallace et Gromit"], 
            }
            
        ];

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('userStatus').innerText = `Welcome: ${user.email}`;

                const userRef = doc(db, 'users', userId);
                const docSnap = await getDoc(userRef);

                if (!docSnap.exists()) {
                    await setDoc(userRef, { userId: userId, totalPlayCountGame13: 0, highestScoreGame13: 0 });
                    console.log("User document created with initial values.");
                } else {
                    const userData = docSnap.data();
                    totalPlayCountGame13 = userData.totalPlayCountGame13 || 0;
                    highestScore = userData.highestScoreGame13 || 0;
                    playCount = totalPlayCountGame13 + 1;
                    console.log(`Loaded totalPlayCountGame13: ${totalPlayCountGame13}, highestScore: ${highestScore}`);
                }
            } else {
                window.location.href = 'login.html';
            }
        });

startBtn.addEventListener('click', async () => {
    score = 0;
    scoreDisplay.innerText = `Current Score: ${score}`;
    inputField.value = '';
    inputField.disabled = false;
    timerDisplay.innerText = '';

    // Increment totalPlayCount and update Firestore
    totalPlayCountGame13 += 1;
    await updateDoc(doc(db, 'users', userId), { totalPlayCountGame13: totalPlayCountGame13 });

    questionIndex = 0;
    showQuestion(questionIndex);

    timer = startTimer(); // Start the timer for the first question

    inputField.addEventListener('keyup', (event) => {
        if (event.key === 'Enter' && inputField.value) {
            clearInterval(timer); // Clear the current timer
            checkAnswer(questionIndex, inputField.value.toUpperCase());
            inputField.value = '';

        }
    });
});
document.getElementById('next-question-btn').addEventListener('click', () => {
    questionIndex++;
    if (questionIndex < questions.length) {
        showQuestion(questionIndex);
        startTimer();
        document.getElementById('next-question-btn').style.display = 'none'; // Hide the button again
    } else {
        endGame();
    }
});
      
function startTimer() {
    let timeLeft = 60; // Set time left for each question
    timerDisplay.innerText = `Temps restant: ${timeLeft}s`;

    clearInterval(timer);
    timer = setInterval(() => {
        timeLeft -= 1;
        timerDisplay.innerText = `Temps restant: ${timeLeft}s`;

        if (timeLeft <= 0) {
            clearInterval(timer);
            inputField.disabled = true; // Disable input after time runs out
            checkAnswer(questionIndex, ''); // Check answer as incorrect if time is up
           document.getElementById('next-question-btn').style.display = 'inline'; // Show "Next Question" button
            
        }
    }, 1000);

    return timer; // Return timer reference for clearing if needed
}


function showQuestion(index) {
    clearInterval(timer);
    const question = questions[index];
    questionDisplay.innerText = question.question;
    timerDisplay.innerText = `Temps restant : 60s`;
    inputField.disabled = false;
    inputField.focus();
    timer = startTimer();
}

        function checkAnswer(index, userAnswer) {
            const correctAnswers = questions[index].answer;
            userAnswer = userAnswer.trim().toLowerCase();
            
             if (correctAnswers.some(answer => answer.toLowerCase() === userAnswer)) {
                score += 5;
                scoreDisplay.innerText = `Score actuel: ${score}`;
                console.log("Correct Answer!");
            } else if (userAnswer !== '') {
                console.log("Incorrect Answer.");
            }
          questionDisplay.innerHTML += `<br><strong>Réponse correcte : ${correctAnswers.join(', ')}</strong>`;
          inputField.disabled = true;
          document.getElementById('next-question-btn').style.display = 'inline'; // Show "Next Question" button
        }

        async function saveScore(score) {
            try {
                const gameData = { score: score, playCount: playCount, timestamp: new Date() };
                await addDoc(collection(db, 'users', userId, 'Game13'), gameData);

                const userRef = doc(db, 'users', userId);
                if (totalPlayCountGame13 <= 1 &&score > highestScore) {
                    highestScore = score;
                    await updateDoc(userRef, { highestScoreGame13: highestScore });
                }
                console.log("Score saved successfully.");
            } catch (error) {
                console.error("Error saving score:", error);
            }
        }

        async function endGame() {
            inputField.disabled = true;
            await saveScore(score); // Save the score at the end of the game
            console.log("Game Over. Final Score:", score);
            alert(`Le quiz est fini! Wow t'avais vraiment pas la ref! Ton score final est: ${score}`);
        }
    </script>
</body>
</html>
