<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¿T'as la ref ou t'as pas la ref ? - Jeu 13 ğŸ¿</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: #ffebcd;
            background-image: url('https://www.transparenttextures.com/patterns/snow.png');
            margin: 0;
        }
        /* Christmas themed title */
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #d32f2f;
            font-family: 'Comic Sans MS', cursive;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }
        #userStatus {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
        }
                
        /* Instructions section */
        #instructions {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            text-align: center;
            max-width: 1000px;
            font-size: 1.2em;
            color: #333;
            overflow-y: auto;  /* Added for scrolling if needed */
            max-height: 300px; /* Set a maximum height */
        }
        #gameArea {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
        }
        #start-btn {
            padding: 10px 20px;
            margin: 10px;
            font-size: 1.5em;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            border: none;
        }
        #start-btn:hover {
            background-color: #0056b3;
        }

        #next-question-btn {
    padding: 10px 20px;
    margin: 10px;
    font-size: 1.5em;
    cursor: pointer;
    background-color: #007BFF;
    color: white;
    border: none;
    display: none; /* Keeps it hidden initially */
}

#next-question-btn:hover {
    background-color: #0056b3;
}
        
        #question {
            font-size: 1.5em;
            margin: 20px;
        }

        #timer, #score {
            font-size: 1.5em;
            margin: 10px;
        }
        #input {
            padding: 20px;
            font-size: 1.5em;
            margin: 10px;
            width: 300px;
        }
      
      

    </style>
</head>
<body>

    <h1>ğŸ¿T'as la ref ou t'as pas la ref ? - Jeu 13 ğŸ¿</h1>
    <div id="userStatus"></div>
    
 <!-- Game instructions -->
    <div id="instructions">
        <p>Fier comme un paon, Dudley paradait autour de ses camarades, savourant chaque victoire comme si elle scellait son statut de "patron" incontestÃ©. Les jeux de lâ€™Ã©tÃ© lâ€™avaient marquÃ©, forÃ§ant chacun Ã  reconnaÃ®tre ses talents dâ€™expert en drapeaux, de pro du Rubikâ€™s Cube et, bien sÃ»r, de maÃ®tre en dÃ©fis improbables comme chanter "Je vous souhaite tout le bonheur du monde" ou supporter stoÃ¯quement des fourmis sur sa main. </p>
  <p>BÃ©bÃ© Romain, qui nâ€™avait pas encore digÃ©rÃ© sa confusion entre les drapeaux de la CÃ´te dâ€™Ivoire et de lâ€™Irlande, bouillonnait de frustration. Les moqueries de Dudley, bien que familiÃ¨res Ã  coups de Â« Tâ€™es bÃªteuuuh Â» , Ã©taient toujours redoutablement efficaces. Pour calmer son Ã©nervement, il prit trois dÃ©s, espÃ©rant un petit coup de chance pour apaiser son ego. Mais mÃªme lÃ , la chance lui Ã©chappa : et quelques minutes plus tard, ce dernier sâ€™Ã©cria Â« Attention au rhino ! Â» avant de sâ€™effondrer la tÃªte la premiÃ¨re dans le canapÃ©, sous les rires Ã©touffÃ©s de ses compagnons.</p>
  <p>Ses talents de dÃ©duction, ses rÃ©flexes et maintenant sa chance mis Ã  mal, BÃ©bÃ© Romain dÃ©cida de riposter sur un autre terrain. En scrutant la tÃ©lÃ©vision du salon, une idÃ©e commenÃ§a Ã  germer. Ã€ cette Ã©poque, il avait passÃ© des heures Ã  se gaver de sÃ©ries comme Lie to Me, Person of Interest, Robin Hood, et The Mentalist. Si Dudley dominait sur les drapeaux, il lui restait, Ã  lui, le cinÃ©ma et les sÃ©ries, sa vraie force.</p>
  <p>Sans oublier son coup de maÃ®tre lÃ©gendaire : la fois oÃ¹ il avait trouvÃ© le califat omeyyade lors dâ€™un quiz, son "banger" personnel, une prouesse qu'il nâ€™Ã©voquait qu'avec un calme feint pour cacher son enthousiasme intÃ©rieur. Â« Tkt, je gÃ¨re, Â» s'Ã©tait-il dit en se forÃ§ant Ã  rester impassible sous les regards Ã©bahis.</p>
  <p>Sortant de ses pensÃ©es, il se tourna vers Topapa, inspirÃ©. Â« Bon, Topapa, jâ€™ai une idÃ©e de Kahoot Ã  te soumettre, Â» dÃ©clara-t-il avec un sourire en coin.</p>
  <p>"Un Kahoot spÃ©cial dessin animÃ© !"</p>
  <p>Explication du jeu : Une description, une rÃ©plique, ou juste une petite rÃ©fÃ©rence. Ã€ partir de cela, vous devez deviner le dessin animÃ© correspondant. Attention, vous nâ€™avez quâ€™un seul essai !</p>
  <p>Petites rÃ¨gles sur la syntaxe : Pas dâ€™accents dans la rÃ©ponse, si câ€™est une saga de films (comme Star Wars), inutile de prÃ©ciser le numÃ©ro et les majuscules ne sont pas nÃ©cessaires (mais acceptÃ©es). Les noms des films sont les noms connus en France (exemple : Lord of the rings devient Â« le seigneur des anneaux Â» mais Â« Your Name Â» ne devient pas Â« Ton PrÃ©nom Â»). Filmez-vous ! Si une rÃ©ponse est correcte mais rejetÃ©e Ã  cause d'un caractÃ¨re manquant ou dâ€™un espace en trop, je pourrai ajuster votre score pour rÃ©parer cette injustice. Vous nâ€™avez quâ€™une tentative pour battre votre meilleur score au quiz.
</p>
    </div>
    
    <div id="gameArea">
        <button id="start-btn">ğŸ…Start GameğŸ…</button>
        <div id="timer"></div>
        <div id="score"></div>
        <button id="next-question-btn" style="display: none;">Prochaine question</button>
        <div id="question"></div>
        <input type="text" id="input" placeholder="RÃ©ponse" disabled>
      

      
    </div>

    <script defer type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4bjg7lVwd8FU8MREaPhBsBENv5qmiYYM",
            authDomain: "calendrier-de-l-avent-54e3a.firebaseapp.com",
            databaseURL: "https://calendrier-de-l-avent-54e3a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "calendrier-de-l-avent-54e3a",
            storageBucket: "calendrier-de-l-avent-54e3a.appspot.com",
            messagingSenderId: "850639567855",
            appId: "1:850639567855:web:0d799a1ecca005fcff141a",
            measurementId: "G-PC1W7RYVEH"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = '';
        let score = 0;
        let playCount = 0;
        let totalPlayCountGame13 = 0;
        let highestScore = 0;
        let questionIndex = 0;
        let timer; 

        const startBtn = document.getElementById('start-btn');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score');
        const questionDisplay = document.getElementById('question');
        const inputField = document.getElementById('input');
        const nextquestionbtn = document.getElementById('next-question-btn');


        const questions = [
            {
                 question: "Une filette dÃ©couvre ses parents transformÃ©s en cochon. Et aprÃ¨s tous les enfants du cinÃ© en sont traumatisÃ©s",
                answer: ["Le voyage de Chihiro" , "Spirited away"], 
            },{
                 question: `Somebody once told me
                    The world is gonna roll me
                    I ain't the sharpest tool in the shed
                    She was looking kind of dumb
                    With her finger and her thumb
                    In the shape of an 'L' on her forehead`,
                answer: ["Shrek"], 
            },
            {
                 question: "Câ€™est lâ€™histoire dâ€™un enfant qui voulait Ãªtre un Ã©norme lÃ¢cheur pour sa famille. Mais Ã  la fin du dessin animÃ©, il a compris que ce nâ€™Ã©tait pas bien dâ€™Ãªtre un lÃ¢cheur. ",
                answer: ["Coco"], 
            },{
                 question: "Comment on appelle une chamelle Ã  3 bosses ? Â« Enceinte Â»",
                answer: ["Zootopie", "Zootopia"], 
            },{
                 question: "Câ€™est lâ€˜histoire dâ€™un pigeon qui voulait Ãªtre le paaaaaaaatrrroooon",
                answer: ["Cigognes et compagnie", "Cigogne et compagnie","Cigognes et cie","Cigogne et cie","Cigognes & cie","Cigogne & Cie"], 
            },{
                 question: "Chuis pas ah ah si mÃ©chant, jfais juste qui me vient naturellement",
                answer: ["Le Lorax", "Lorax"], 
            },{
                 question: "Pas de cape",
                answer: ["Les Indestructibles", "Indestructibles"], 
            },{
                 question: ` DisgrÃ¢ce infÃ¢me
                             Parfum d'infÃ¢me
                             Qui inonde mon Ã¢me
                             Oh, Ã§a pue le drame
                             Je dÃ©clenche une tempÃªte
                             PitiÃ©, arrÃªte
                             Ã€ chaque fois que je...`,
                answer: ["Roi Lion", "Le roi lion", "Lion King"], 
            },{
                 question: "Liste des protagonistes : Marie, Toulouse, Berlioz, Duchesse, Edgar, Thomas",
                answer: ["Les aristochats", "Aristochats", "Aristocats"], 
            },{
                 question: "Des schtroumpfs jaunes traversent les Ã©poques en essayant de proposer leur service mais ne font que causer des calamitÃ©s. ",
                answer: ["Les minions", "Minions"], 
            },{
                 question: "OÃ¹ je suis ? Qu'est qu'il c'est passÃ© ? C'est bizarre c'Ã©tait moins douillet. Alors C'est Ã§a le monde ? J'prÃ©fÃ©rÃ© avant... C'est drÃ´le le papier peint Ã  changer. Ce monde est bien Ã©trange. J'ai faim J'ai froid Je veux qu'on m'change ! Ce monde est tout nouveau pour moi !",
                answer: ["Les Razmoket", "Les Razmokets", "Les Razmocket", "Les Razmockets", "Razmocket", "Razmockets", "Razmoket", "Razmokets"], 
            },{
                 question: "Le crocheeeeetttt",
                answer: ["Toy Story"], 
            },{
                 question: "Maxi outil, Maxi outil, Maxi outil magique. â€¦ Câ€™est un outil surprise qui nous servira plus tard. ",
                answer: ["La maison de mickey"], 
            },{
                 question: "Un serpent du nom de Triste Sire. ",
                answer: ["Robin des Bois", "Robin Hood"], 
            },{
                 question: "L'histoire se dÃ©roule Ã  New York dans les annÃ©es 1980. Un petit chaton abandonnÃ©, aprÃ¨s avoir passÃ© une nuit sous la pluie, tente de voler des saucisses Ã  un vendeur ambulant qui repousse violemment le pauvre chaton affamÃ©. Le chaton rencontre alors Roublard, un chien errant qui propose de faire Ã©quipe afin de rÃ©cupÃ©rer les saucisses. Le plan de Roublard fonctionne mais une fois les saucisses en sa possession, il fuit Ã  travers la ville sans partager son butin avec son coÃ©quipier. Le chaton suit Roublard jusqu'Ã  sa destination: une pÃ©niche dÃ©labrÃ©e amarrÃ©e aux docks. Alors que le chaton tente de regarder ce qui se passe Ã  l'intÃ©rieur depuis le plafond, le plancher cÃ¨de et il tombe au milieu d'une meute de chiens composÃ© de Roublard et ses amis, le chihuahua Tito, le dogue allemand Einstein, le bouledogue intellectuel Francis et la levrette persane affectueuse Rita. ",
                answer: ["Oliver et compagnie", "Oliver & Cie", "Oliver & Compagnie" , " Oliver et Cie"], 
            },{
                 question: `Comme un homme
                            Sois plus violent 
                            que le cours du torrent
                            Comme un homme
                            Sois plus puissant que les ouragans 
                            Comme un homme
                            Sois plus ardent que le feu des volcans` ,
                answer: ["Mulan"], 
            },{
                 question: "La scÃ¨ne mythique se joue Ã  lâ€™arriÃ¨re dâ€™un restaurant italien quand les deux amoureux se retrouvent autour dâ€™un seul plat de spaghetti. ",
                answer: ["La belle et le clochard"], 
            },{
                 question: "Un renard et un chien sont les meilleurs amis du monde. Mais leur relation change quand le maitre du chien lâ€™apprend Ã  chasser. ",
                answer: ["Rox et rouky", "Rox et Rooky", "Rox et Roucky", "Rox et Roocky"], 
            },{
                 question: "Lâ€™extinction des dodos est expliquÃ©e dans ce dessin animÃ©",
                answer: ["L'age de glace", "L'Ã¢ge de glace", "Age de glace", "Ã¢ge de glace", "Ice age"], 
            },{
                 question: "Un petit dessin animÃ© en pÃ¢te Ã  modeler qui met en avant un personne habillÃ© Ã  la brittanique connu pour son amour du fromage et un chien trÃ¨s intelligent",
                answer: ["Wallace et Gromit"], 
            }
            
        ];

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('userStatus').innerText = `Welcome: ${user.email}`;

                const userRef = doc(db, 'users', userId);
                const docSnap = await getDoc(userRef);

                if (!docSnap.exists()) {
                    await setDoc(userRef, { userId: userId, totalPlayCountGame13: 0, highestScoreGame13: 0 });
                    console.log("User document created with initial values.");
                } else {
                    const userData = docSnap.data();
                    totalPlayCountGame13 = userData.totalPlayCountGame13 || 0;
                    highestScore = userData.highestScoreGame13 || 0;
                    playCount = totalPlayCountGame13 + 1;
                    console.log(`Loaded totalPlayCountGame13: ${totalPlayCountGame13}, highestScore: ${highestScore}`);
                }
            } else {
                window.location.href = 'login.html';
            }
        });

startBtn.addEventListener('click', async () => {
    score = 0;
    scoreDisplay.innerText = `Current Score: ${score}`;
    inputField.value = '';
    inputField.disabled = false;
    timerDisplay.innerText = '';

    // Increment totalPlayCount and update Firestore
    totalPlayCountGame13 += 1;
    await updateDoc(doc(db, 'users', userId), { totalPlayCountGame13: totalPlayCountGame13 });

    questionIndex = 0;
    showQuestion(questionIndex);

    timer = startTimer(); // Start the timer for the first question

    inputField.addEventListener('keyup', (event) => {
        if (event.key === 'Enter' && inputField.value) {
            clearInterval(timer); // Clear the current timer
            checkAnswer(questionIndex, inputField.value.toUpperCase());
            inputField.value = '';

        }
    });
});
document.getElementById('next-question-btn').addEventListener('click', () => {
    questionIndex++;
    if (questionIndex < questions.length) {
        showQuestion(questionIndex);
        startTimer();
        document.getElementById('next-question-btn').style.display = 'none'; // Hide the button again
    } else {
        endGame();
    }
});
      
function startTimer() {
    let timeLeft = 60; // Set time left for each question
    timerDisplay.innerText = `Temps restant: ${timeLeft}s`;

    clearInterval(timer);
    timer = setInterval(() => {
        timeLeft -= 1;
        timerDisplay.innerText = `Temps restant: ${timeLeft}s`;

        if (timeLeft <= 0) {
            clearInterval(timer);
            inputField.disabled = true; // Disable input after time runs out
            checkAnswer(questionIndex, ''); // Check answer as incorrect if time is up
           document.getElementById('next-question-btn').style.display = 'inline'; // Show "Next Question" button
            
        }
    }, 1000);

    return timer; // Return timer reference for clearing if needed
}


function showQuestion(index) {
    clearInterval(timer);
    const question = questions[index];
    questionDisplay.innerText = question.question;
    timerDisplay.innerText = `Temps restant : 60s`;
    inputField.disabled = false;
    inputField.focus();
    timer = startTimer();
}

        function checkAnswer(index, userAnswer) {
            const correctAnswers = questions[index].answer;
            userAnswer = userAnswer.trim().toLowerCase();
            
             if (correctAnswers.some(answer => answer.toLowerCase() === userAnswer)) {
                score += 5;
                scoreDisplay.innerText = `Score actuel: ${score}`;
                console.log("Correct Answer!");
            } else if (userAnswer !== '') {
                console.log("Incorrect Answer.");
            }
          questionDisplay.innerHTML += `<br><strong>RÃ©ponse correcte : ${correctAnswers.join(', ')}</strong>`;
          inputField.disabled = true;
          document.getElementById('next-question-btn').style.display = 'inline'; // Show "Next Question" button
        }

        async function saveScore(score) {
            try {
                const gameData = { score: score, playCount: playCount, timestamp: new Date() };
                await addDoc(collection(db, 'users', userId, 'Game13'), gameData);

                const userRef = doc(db, 'users', userId);
                if (totalPlayCountGame13 <= 1 &&score > highestScore) {
                    highestScore = score;
                    await updateDoc(userRef, { highestScoreGame13: highestScore });
                }
                console.log("Score saved successfully.");
            } catch (error) {
                console.error("Error saving score:", error);
            }
        }

        async function endGame() {
            inputField.disabled = true;
            await saveScore(score); // Save the score at the end of the game
            console.log("Game Over. Final Score:", score);
            alert(`Le quiz est fini! Wow t'avais vraiment pas la ref! Ton score final est: ${score}`);
        }
    </script>
</body>
</html>
