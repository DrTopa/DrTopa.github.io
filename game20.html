<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Game</title>
    <style>
                body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: #ffebcd;
            background-image: url('https://www.transparenttextures.com/patterns/snow.png');
            margin: 0;
            overflow-y: auto;  /* Added for scrolling if needed */
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #d32f2f;
            font-family: 'Comic Sans MS', cursive;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }


        
        /* User status */
        #userStatus {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
            color: #a23636;
        }
               /* Instructions section */
        #instructions {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            text-align: center;
            max-width: 1000px;
            font-size: 1.2em;
            color: #333;
            overflow-y: auto;  /* Added for scrolling if needed */
            max-height: 400px; /* Set a maximum height */

        }
       
        .game-area {
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, sans-serif;;
            background-color: pink;
            color: white;
            text-align: center;
            margin: 0;
        }
        
        .input-group {
            margin: 10px;
        }
        button {
            background-color: white;
            color: pink;
            padding: 10px 20px;
            border: none;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background-color: lightgray;
        }
        #startButton {
            font-size: 20px;
            padding: 15px 30px;
        }

            #highest-score, #total-play-count {
            margin-left: 20px;
            font-size: 1.2em;
            font-size: 1.5em;
            color: #00000;
        }
        
        #highest-score, #total-play-count {
    margin-top: 10px; /* Ensure there’s space between the score and the others */
}
        .decoration {
    position: relative; /* Change to relative */
    display: flex; /* Use flexbox for centering */
    justify-content: center; /* Horizontally center */
    align-items: center; /* Vertically center */
    height: 100vh; /* Full viewport height to center */
    padding: 20px 0;
}

#santa {
    height: 400px;
    width: auto;
}
        
    </style>
</head>
<body>
    <h1>⛳️Comme dans une caverne⛳️</h1>
    <div id="instructions">
        <p>« Si mes calculs sont corrects, on est censés être vendredi 20 décembre dans le présent », déclara Grinchémie « Il faut absolument qu’on sorte du passé. » Elle jeta un regard inquiet à ses compagnons. « C’est vendredi soir, les familles doivent commencer à se réunir pour les fêtes sauf s’il y a un lâcheur de l’extrême. Si on traîne, on va rater le début de Noël ! »</p>
<p>La ceinture magique de Noël, toujours prompte à intervenir, scintilla doucement. « Cela tombe bien », répondit-elle d’une voix apaisante. « Dès demain, vous pourrez retourner dans le présent. Mais avant cela, nous avons encore une dernière étape. En route pour… 2002 ! »</p>
<p>« 2002 ? C’est quoi cette année ? Il n’y avait même pas de vrais jeux à l’époque ! » marmonna Bébé Romain, visiblement peu emballé. Topapa, toujours nostalgique, leva un doigt. «Il y avait les Razmoket sur PS1 ! »</p>
<p>« Ce n’est pas ça », rétorqua la ceinture avant de les emporter dans un tourbillon lumineux. En un clin d'œil, ils se retrouvèrent à Viroflay, mais quelque chose clochait. Jacques Chirac trônait au centre du jardin.</p>
<p>« Euh, STOP. Attendez une minute », interrompit Thaddée en levant la main. « Jacques Chirac dans le jardin ? Ça sent le grand n’importe quoi. »</p>
<p>« Jacques Chirac, c’est le nom du cerisier du jardin, tête de noeil ! » répondit le narrateur avec une pointe d’exaspération.</p>
<p>« Ah my baaad ! » fit Thaddée en levant les mains comme un hold-up.</p>
<p>Le narrateur revint à son histoire. Les 5 compères faisaient…Ah super, je suis perdu maintenant. </p>
<p>« Ne t’en fais pas, je m’occupe de la suite » dit Barbara en tissant sa toile pour les jumeaux qu’elle attendait. Et cette dernière commença la narration. </p>
<p>Les cinq compagnons s’avançaient vers la maison familiale. À cette époque, l’ordinateur familial était une relique. Une antiquité imposante, coincée dans un coin du salon, qui grondait dès qu’on l’allumait. Bébé Romain, curieux, s’approcha et alluma l’appareil, mais avant qu’il ne fasse quoi que ce soit, il s’interrompit.</p>
<p>« Attendez une minute… Si je lève la lunette des toilettes quand je pisse, ce sera plus facile pour viser ! » s’exclama-t-il, illuminé par une révélation soudaine.</p>
<p>Dudley et RaseToiLaMoustache restèrent bouche bée, les yeux écarquillés. « Génie… absolu. » Dudley, pris par une inspiration divine, commença à tailler une statue de Bébé Romain dans un bout de bois trouvé sur place. RaseToiLaMoustache, quant à lui, chercha désespérément un téléphone pour immortaliser ce hack révolutionnaire en vidéo. Mais, hélas, les réseaux sociaux n’existaient pas encore, et cette révélation fut perdue à jamais dans le flot du temps.</p>
<p>Déçus, les compagnons reportèrent leur attention sur l’ordinateur. Dudley attrapa la vieille souris à boule, pleine de poussière, et se mit à fouiller dans les tréfonds du système d’exploitation. Tout à coup, une petite icône apparut : un trombone souriant.</p>
<p>« Bonjour, je m’appelle Clippy ! En quoi puis-je vous aider ? »</p>
<p>« Oh non… Clippy, l’IA originel », soupira Bébé Romain. « Écoute, on cherche un jeu. Quels jeux sont installés sur cet ordinateur ? »</p>
<p>Clippy répondit, joyeux comme à son habitude :</p>
<p>« Liste des jeux :</p>
<p>•	Excel : Apprenez à créer des tableaux dynamiques avec Clippy !</p>
<p>•	Word : Changez vos polices et vos couleurs avec moi !</p>
<p>« Si tu me dis encore PowerPoint, je te désinstalle », gronda Bébé Romain, excédé.</p>
<p>Clippy, imperturbable, continua : « Pas de souci ! PowerPoint : Ajoutez des transitions avion en papier pour impressionner vos profs ! »</p>
<p>« Ça suffit ! » cria Bébé Romain en se déconnectant brutalement.</p>
<p>Topapa prit alors la souris, déterminé à trouver quelque chose de plus amusant. Il balaya les icônes du bureau avec attention, et soudain, son regard se posa sur une icône rose. Avec un sourire, il cliqua dessus. « J’ai trouvé. Préparez-vous, on va jouer. »</p>
<p>« Ah merci pour le coup de main Barbara » dit le narrateur</p>
<p>« Oh de rien, ça me fait plaisir de faire plaisir » répondit Barbara</p>
<p>« Je te souhaite pleins de bonnes choses pour la suite, mais avec tout le karma positif que tu récoltes entre ça et l’association bénévole pour aider les enfants handicapés, je n’ai aucun doute que tout va rouler pour toi »</p>
<p>Barbara esquissa un petit rire gênée et quitta la scène, laissant derrière elle un éclat de bienveillance qui illumina les cœurs de tous.</p>
<p>Explication du jeu : Voilà le dernier jeu. Le calendrier de l’avent a commencé avec un jeu bien guez de votre codeur préféré et il finira par un jeu bien guez de votre codeur détesté. Je vous présente cette inoubliable jeu de golf sans animation avec juste du texte avec le fameux fond rose dégeu. </p>
<p>Le but du jeu est simple. Réussir à mettre la balle dans le trou en le moins de coups possibles. Il y a 5 manches où les trous seront de plus en plus loin. Vous devez rentrer la vitesse initiale de votre balle (entre 0 et 10) ainsi que l’angle de shoot (entre -90 et 90). Vous devez ensuite choisir quel club vous voulez utiliser (sachant que le putter est plutôt pour la précision et le driver pour le bourrin). L’objectif est donc d’approcher la balle à moins de 3 mètres du trou pour pouvoir passer au trou d’après. </p>
<p>Après un tir, une phrase vous indique de combien vous avez avancé et à combien de mètre se trouve le trou. MAIS ATTENTION, si vous avez tiré ‘trop fort’, vous vous situeriez derrière le trou (exemple : le trou est à 5 mètres. Vous tirez et on vous indique que vous avez tiré de 10 mètres et que le trou est à 5 mètres, il faut donc comprendre que vous vous trouvez DERRIERE le trou. Au prochain tir il faut donc tirer avec un angle NEGATIF pour aller dans la bonne direction. Attention donc à la distance qu’il vous reste à parcourir et la distance parcourue pour savoir si vous êtes devant ou derrière le trou. </p>
<p>Vous n’avez le droit qu’à 2 essais. Sachant que la première manche permet de se chauffer et que pendant la 2e, la moitié d’entre vous seront déjà en train de faire les calculs pour craquer le code derrière. 
</p>
         </div>
     <img id="santa" class="decoration" src="https://i.imgur.com/REAhcdA.jpeg" alt="Santa Claus">
    <div id="highest-score">Meilleur score: 0</div>
    <div id="total-play-count">Jeux joués: 0</div>
     <div id="userStatus"></div>
    
    <!-- Start Button (Initially visible) -->
    <div id="startScreen">
        <button id="startButton" >Start Game</button>
    </div>
   
    
    <!-- Game Area (Initially hidden) -->
    <div class="game-area" id="gameArea" style="display: none;">
        <p id="windMessage"></p>
        <div class="input-group">
            <label for="speed">Vitesse initiale (1-10): </label>
            <input type="number" id="speed" min="1" max="10" />
        </div>
        <div class="input-group">
            <label for="angle">Angle (degrees): </label>
            <input type="number" id="angle" min="-90" max="90" />
        </div>
        <div class="input-group">
            <label for="club">Choisis ton club: </label>
            <select id="club">
                <option value="1">Putter</option>
                <option value="2">Wedge</option>
                <option value="3">Iron 1</option>
                <option value="4">Iron 2</option>
                <option value="5">Driver</option>
            </select>
        </div>
        <div>
            <button id="playButton">Tire!</button>
            <button id="nextButton" style="display: none;">Prochain trou</button>
        </div>
        <p id="shootCount"></p>
        <p id="totalShootCount"></p>
        <p id="message"></p>
    </div>

   <script defer type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4bjg7lVwd8FU8MREaPhBsBENv5qmiYYM",
            authDomain: "calendrier-de-l-avent-54e3a.firebaseapp.com",
            databaseURL: "https://calendrier-de-l-avent-54e3a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "calendrier-de-l-avent-54e3a",
            storageBucket: "calendrier-de-l-avent-54e3a.appspot.com",
            messagingSenderId: "850639567855",
            appId: "1:850639567855:web:0d799a1ecca005fcff141a",
            measurementId: "G-PC1W7RYVEH"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let userId = '';
        let totalPlayCountGame20 = 0;
        let highestScore = 0;
        let highestScoreGame20 = 0

        const highestScoreDisplay = document.getElementById('highest-score');
        const totalPlayCountDisplay = document.getElementById('total-play-count');

       
        const holes = [200, 300, 400, 500, 1000]; // Distances of the holes
        let currentRound = 0;
        let wind = Math.random() * 20 - 10; // Random wind factor between -10 and 10
        let currentPosition = 0; // Tracks the ball's current position
        let shootCounter = 0; // Counts the number of times the user presses "Shoot" in the current round
        let totalShots = 0; // Cumulative count of shots taken across all rounds

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('userStatus').innerText = `Bienvenue : ${user.email}`;

                const userRef = doc(db, 'users', userId);
                const docSnap = await getDoc(userRef);

                if (!docSnap.exists()) {
                    await setDoc(userRef, { userId: userId, totalPlayCountGame20: 0, highestScoreGame20: 0, UserEmail: user.email });
                } else {
                    const userData = docSnap.data();
                    totalPlayCountGame20 = userData.totalPlayCountGame20 || 0;
                    highestScoreGame20 = userData.highestScoreGame20 || 0;

                    UserEmail: user.email
                    
                    highestScoreDisplay.innerText = `Meilleur score: ${highestScoreGame20}`;
                    totalPlayCountDisplay.innerText = `Jeux joués: ${totalPlayCountGame20}`;
                    
                    
                }
            } else {
                window.location.href = 'login.html';
            }
        });


        // Function to update and display round details and wind
        function updateRoundDetails() {
            const roundDistance = holes[currentRound];
            document.getElementById("windMessage").innerText = `Vent: ${wind.toFixed(1)} m/s | Round ${currentRound + 1}/5: Distance ${roundDistance}m`;
        }

        // Display the initial wind and round details
        updateRoundDetails();

        // Start the game
        function startGame() {
             totalPlayCountGame20 += 1;
             totalPlayCountDisplay.innerText = `Jeux joués: ${totalPlayCountGame20}`;  // Update display for total play count
            // Hide the start screen and show the game area
            document.getElementById("startScreen").style.display = "none";
            document.getElementById("gameArea").style.display = "block";

            // Initialize the game
            updateRoundDetails();
        }

        function playRound() {
            const speed = parseFloat(document.getElementById("speed").value);
            let angle = parseFloat(document.getElementById("angle").value);
            const clubMultiplier = parseInt(document.getElementById("club").value);

            if (isNaN(speed) || isNaN(angle) || speed < 1 || speed > 10 || angle < -90 || angle > 90) {
                document.getElementById("message").innerText = "La valeur de la vitesse ou de l'angle n'est pas correcte";
                return;
            }

            shootCounter++; // Increment shoot counter
            totalShots++; // Increment total shots
            document.getElementById("shootCount").innerText = `Tirs effectués à ce round: ${shootCounter}`;
            document.getElementById("totalShootCount").innerText = `Nombre total de tirs: ${totalShots}`;

            // Calculate ball position
            const initialVelocity = speed * clubMultiplier + wind;
            const radianAngle = (Math.PI / 180) * angle;
            const distance = Math.round((initialVelocity ** 2 * Math.sin(2 * radianAngle)) / 9.8);

            // Update current position
            currentPosition += distance;

            // Get the current hole distance
            const holeDistance = holes[currentRound];
            const distanceToHole = Math.abs(holeDistance - currentPosition);

            // Handle overshooting
            if (currentPosition > holeDistance) {
                angle = 180 - angle; // Flip the angle
                document.getElementById("message").innerText += `\nYou overshot the hole! Adjusting angle to ${angle} degrees.`;
            }

            // Update the round or continue
            if (distanceToHole < 3) {
                document.getElementById("message").innerText = `Trou ${currentRound + 1}:  Cela t'a pris ${shootCounter} tirs pour réussir ce round`;
                document.getElementById("nextButton").style.display = "inline"; // Show "Next Hole" button
            } else {
                document.getElementById("message").innerText = `Trou ${currentRound + 1}: Tu as frappé la balle sur ${distance} metres. Tu es à ${distanceToHole} metres du trou.`;
            }
        }

        function nextHole() {
            if (currentRound >= holes.length - 1) {
                document.getElementById("message").innerText = "Game Over!";
                saveScore();
                document.getElementById("nextButton").style.display = "none"; // Hide "Next Hole" button
                return;
            }

            currentRound++; // Move to the next round
            currentPosition = 0; // Reset position for the new hole
            shootCounter = 0; // Reset shoot counter for the current round
            wind = Math.random() * 20 - 10; // Generate new wind
            updateRoundDetails(); // Update wind and round details
            document.getElementById("message").innerText = ""; // Clear previous messages
            document.getElementById("shootCount").innerText = ""; // Clear shoot count for the current round
            document.getElementById("nextButton").style.display = "none"; // Hide "Next Hole" button
        }

              async function saveScore() {
            try {
                highestScore = 100-(2*totalShots);
                const gameData = { score: highestScore, playCount: totalPlayCountGame20, timestamp: new Date() };
                await addDoc(collection(db, 'users', userId, 'Game20'), gameData);
                await updateDoc(doc(db, 'users', userId), { totalPlayCountGame20: totalPlayCountGame20 });
                console.log("Saving score:", highestScore);
                
                const userRef = doc(db, 'users', userId);
                
                if (totalPlayCountGame20 <= 2 && highestScore > highestScoreGame20) {
                    await updateDoc(userRef, { highestScoreGame20: highestScore });
                    highestScoreDisplay.innerText = `Meilleur score: ${highestScore}`; // Update display for highest score
                }
            } catch (error) {
                console.error("Error saving score:", error);
            }
        }

       document.addEventListener("DOMContentLoaded", function() {
        // Get the start button by ID and add a click event listener
        const startButton = document.getElementById("startButton");
        if (startButton) {
            startButton.addEventListener("click", startGame); // Attach the startGame function
        }
         const playButton = document.getElementById("playButton");
        if (playButton) {
            playButton.addEventListener("click", playRound); // Attach the playRound function
        }

        // Get the "Prochain trou" button and add a click event listener
        const nextButton = document.getElementById("nextButton");
        if (nextButton) {
            nextButton.addEventListener("click", nextHole); // Attach the nextHole function
        }
           });
    </script>
</body>
</html>
