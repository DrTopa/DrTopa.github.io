<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quizz du passÃ© </title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            background-color: #ffebcd;
            background-image: url('https://www.transparenttextures.com/patterns/snow.png');
            margin: 0;
        }
        /* Christmas themed title */
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #d32f2f;
            font-family: 'Comic Sans MS', cursive;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }
        #userStatus {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
        }
                
        /* Instructions section */
        #instructions {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            text-align: center;
            max-width: 1000px;
            font-size: 1.2em;
            color: #333;
            overflow-y: auto;  /* Added for scrolling if needed */
            max-height: 300px; /* Set a maximum height */
        }
        #gameArea {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
        }
        #start-btn {
            padding: 10px 0px;
            margin: 10px;
            font-size: 1.5em;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            border: none;
        }
        #start-btn:hover {
            background-color: #0056b3;
        }
        #question {
            font-size: 1.5em;
            margin: 0px;
        }
        #options {
            font-size: 1.em;
            margin: 10px;
        }
        #timer, #score {
            font-size: 1.5em;
            margin: 10px;
        }
        #input {
            padding: 10px;
            font-size: 1.em;
            margin: 10px;
            width: 50px;
        }
      
        /* Snowflake styles */
        .snowflake {
            position: absolute;
            top: -10px;
            color: white;
            font-size: 1em; /* Adjust the size of the snowflakes */
            pointer-events: none;
            opacity: 0.8;
            animation: fall linear infinite;
        }

        @keyframes fall {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(100vh);
            }
        }
    </style>
</head>
<body>

    <h1>ðŸŽ… Quizz du passÃ© ðŸŽ…</h1>
    <div id="userStatus"></div>
    
 <!-- Game instructions -->
    <div id="instructions">
        <p>Lâ€™atelier de Topapa ressemblait dÃ©sormais Ã  une vÃ©ritable auberge espagnole. Les bÃ©bÃ©s Romain se disputaient fÃ©rocement, se mordillant les chaussures, tandis que le Dudley se lanÃ§ait dans une compÃ©tition dâ€™intensitÃ© avec GrinchÃ©mie, jouant Ã  qui Â« ker Â» le mieux son Â« im Â». De son cÃ´tÃ©, RaseToiLaMoustache, avec lâ€™esprit rebelle et lâ€™audace dâ€™un jeune yolo, marquait son territoire en levant la patte sur le mur de l'atelier.</p>
<p>Au milieu de ce chaos sans nom, Topapa, totalement dÃ©bordÃ©, voyait ses prÃ©paratifs de NoÃ«l prendre un retard monumental. Des rouleaux de papier cadeau traÃ®naient dans un coin, des rubans volaient dans tous les sens, et les cadeaux nâ€™Ã©taient mÃªme pas emballÃ©s. Soudain, alors quâ€™il croyait perdre la bataille, une lumiÃ¨re intense descendit du ciel, illuminant la piÃ¨ce dâ€™un Ã©clat dorÃ©. Devant lui apparut une entitÃ© divine, sous la formeâ€¦ dâ€™une ceinture en cuir brillante.</p>
<p>Sans crier gare, la ceinture magique fit son Å“uvre et vlah, chacun en reÃ§ut un bon coup pour le rappeler Ã  lâ€™ordre ! Sauf Dudley, bien sÃ»r. Lui, en tant que chouchou, ne reÃ§ut quâ€™une petite caresse, presque bienveillante, pour ne pas froisser son jeune ego.</p>
<p>Â« Mes enfants, Â» tonna la ceinture cÃ©leste, dâ€™une voix grave, Â« sauf le Phasmeâ€¦ toi, tu es adoptÃ©â€¦ ressaisissez-vous ! Il est temps de vous unir et de former une Ã©quipe digne de sauver NoÃ«l ! Pour y parvenir, vous allez devoir rÃ©ussir une sÃ©rie de dÃ©fis. Je vais vous envoyer dans le passÃ© pour un team building faÃ§on "vintage". Souvenez-vous bien : seuls ceux qui rÃ©ussissent les jeux dâ€™antan pourront en sortir. Ensemble, vous y arriverezâ€¦ peut-Ãªtre. Â»</p>
<p>Ã€ peine ces paroles prononcÃ©es, un tourbillon lumineux enveloppa les cinq protagonistes, les transportant instantanÃ©ment dans un couloir sombre et mystÃ©rieux. Autour dâ€™eux, le silence, entrecoupÃ© de leurs respirations anxieuses. Devant eux se tenait une seule porte, vieille et grinÃ§ante, qui semblait les inviter Ã  entrer.</p>
<p>Sans trop rÃ©flÃ©chir, ils sâ€™y engouffrÃ¨rent, le cÅ“ur battant, prÃªts Ã  affronter des Ã©preuves quâ€™ils nâ€™imaginaient mÃªme pas.</p>

<p>Ils entrÃ¨rent dans la salle, et Ã  leur grande surprise, elle ressemblait Ã©trangement Ã  la caverne de GrinchÃ©mie. Les murs Ã©taient dâ€™un rose Ã©clatant, presque agressif. GrinchÃ©mie plissa les yeux, perplexe. Â« Attendez une minuteâ€¦ les murs de ma caverne ne sont plus roses depuis des lustres. Â» Une lueur de comprÃ©hension traversa son regard. Â« Nous sommes dans le passÃ© ! Â» dÃ©clara-t-elle avec triomphe.</p>
<p>Dudley, appuyÃ© contre un mur, leva les yeux au ciel. Â« Oui, bravo, Â» rÃ©pondit-il avec un soupÃ§on de sarcasme. Â« Quelle perspicacitÃ©, Flash McQueen. Â»</p>
<p>Soudain, la ceinture divine rÃ©apparut silencieusement derriÃ¨re eux, flottant dans lâ€™air. Â« Seulement de quelques mois, Â» prÃ©cisa-t-elle dâ€™un ton solennel. Â« Vous allez devoir passer un quiz sur un jeu qui, je lâ€™espÃ¨re, vous a enseignÃ© quelques leÃ§ons utiles. Â»</p>
<p>Elle marqua une pause thÃ©Ã¢trale avant dâ€™ajouter : Â« Et puis, soyons honnÃªtesâ€¦ le narrateur de cette histoire, qui est aussi le dÃ©veloppeur du site, nâ€™a pas eu le temps de coder une nouvelle page. Des bugs, du temps perduâ€¦ donc voilÃ , on recycle les Ã©preuves prÃ©cÃ©dentes. Â»</p>
<p>Tout le groupe se regarda, mi-intriguÃ©, mi-amusÃ© par cette chute inattendue du quatriÃ¨me mur. RaseToiLaMoustache en profita pour intervenir, Â« Dâ€™ailleurs, puisquâ€™on parle franchement, pourquoi je suis le seul personnagequi ne parle pas et qui se fait bolosser ? Jâ€™aimerais aussi un peu deâ€¦ Â»</p>
<p>Mais avant quâ€™il puisse finir, le quatriÃ¨me mur se rÃ©tablit brusquement, et sa rÃ©plique se perdit dans un murmure incomprÃ©hensible : Â« Meuhouauhahâ€¦ Â»</p>
<p>BÃ©bÃ© Romain le regarda, perplexe, et haussa les Ã©paules. Â« Je pense quâ€™il est constipÃ©, Â» dÃ©clara-t-il avec un sÃ©rieux dÃ©concertant.</p>
<p>Un silence de plomb sâ€™installa, avant que GrinchÃ©mie ne laisse Ã©chapper un rire nerveux. La ceinture divine, quant Ã  elle, secoua son extrÃ©mitÃ© en soupirant. Â« Allons, mes chers, assez de bavardages ! Le quiz vous attend, et vous devrez rÃ©pondre avec prÃ©cisionâ€¦ et solidaritÃ© ! Â»</p>
<p>Explication du jeu : Il sâ€™agit encore dâ€™un quizz comme le jeu 2. Sauf que les questions sont pas les mÃªmes . VoilÃ , rien dâ€™autre. 

</p>
    </div>
    
    <div id="gameArea">
        <button id="start-btn">ðŸŽ…Start GameðŸŽ…</button>
        <div id="timer"></div>
        <div id="score"></div>
        <div id="question"></div>
        <div id="options"></div>
        <input type="text" id="input" placeholder="A/B/C/D" maxlength="1" disabled>
    </div>

    <script defer type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4bjg7lVwd8FU8MREaPhBsBENv5qmiYYM",
            authDomain: "calendrier-de-l-avent-54e3a.firebaseapp.com",
            databaseURL: "https://calendrier-de-l-avent-54e3a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "calendrier-de-l-avent-54e3a",
            storageBucket: "calendrier-de-l-avent-54e3a.appspot.com",
            messagingSenderId: "850639567855",
            appId: "1:850639567855:web:0d799a1ecca005fcff141a",
            measurementId: "G-PC1W7RYVEH"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = '';
        let score = 0;
        let playCount = 0;
        let totalPlayCountGame6 = 0;
        let highestScore = 0;

        const startBtn = document.getElementById('start-btn');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score');
        const questionDisplay = document.getElementById('question');
        const optionsDisplay = document.getElementById('options');
        const inputField = document.getElementById('input');

        
            // Create falling snowflakes
        function createSnowflakes() {
            const snowflakeCount = 100; // Number of snowflakes to create
            for (let i = 0; i < snowflakeCount; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.innerText = 'â„ï¸'; // Snowflake character
                snowflake.style.left = Math.random() * 100 + 'vw'; // Random horizontal position
                snowflake.style.animationDuration = Math.random() * 3 + 2 + 's'; // Random fall speed
                snowflake.style.opacity = Math.random(); // Random opacity
                document.body.appendChild(snowflake);
            }
        }

        createSnowflakes(); // Call the function to create snowflakes

        const questions = [
            {
                question: "TOP 15 : Quel est le 2e pays avec la plus grande superficie ?",
                options: ["A) Russie", "B) Canada", "C) USA", "D) Chine"],
                answer: "B"
            },
            {
                question: "Quelle est la 3e langue la plus parlÃ©e au monde ?",
                options: ["A) Mandarin", "B) Espagnol", "C) Hindi", "D) Arabe"],
                answer: "C"
            },
            {
                question: "Quel est le film le plus rentable en terme de recettes?",
                options: ["A) Star wars 7 ", "B) Avatar", "C) Titanic", "D) Avengers : Endgame"],
                answer: "D"
            },
            {
                question: "Qui est l'artiste la plus Ã©coutÃ©s sur Spotify (en nombre de streams) ?",
                options: ["A) Taylor Swift", "B) Drake", "C) Eminem", "D) Joe Hisaishi"],
                answer: "A"
            },
            {
                question: "En terme de capital boursier, a quelle place se situait Amazon en 2023",
                options: ["A) 1", "B) 5", "C) 12", "D) Hors du Top 15"],
                answer: "B"
            },
            {
                question: "Quel est le jeu de sociÃ©tÃ© le plus vendu au monde?",
                options: ["A) Echecs", "B) Catan", "C) Elbofos", "D) Monopoly"],
                answer: "A"
            },
            {
                question: "En nombre de population, Ã  quel rang se situe la mÃ©galopole de Delhi dans le monde",
                options: ["A) 1 ", "B) 3", "C) 5", "D) 7"],
                answer: "C"
            },
            {
                question: "En nombre de population, Ã  quel rang se situe la ville de Goris en ArmÃ©nie ",
                options: ["A) 2", "B) 6", "C) 9", "D) 10"],
                answer: "D"
            },
            {
                question:" Quelle marque de voitures produit-elle le plus d'automobiles ?",
                options: ["A) Toyota", "B) Nissan", "C) General motors", "D) Volkswagen"],
                answer: "A"
            },
            {
                question: "En nombre d'entrÃ©es, qui est le 10e acteur franÃ§ais qui en a rÃ©alisÃ© le plus ?",
                options: ["A) Galabru, "B) Delon", "C) Belmondo", "D) Lhermitte"],
                answer: "B"
            },
            {    
                question: "En nombre d'entrÃ©es, qui est le 10e acteur franÃ§ais qui en a rÃ©alisÃ© le plus ?",
                options: ["A) Bardot ", "B) Miou-Miou", "C) MichÃ¨le Morgan", "D)  Tautou"],
                answer: "C"
            },
            {
                question: "Laquelle de ces consoles est la 3e la plus vendues de tous les temps",
                options: ["Xbox 360", "B) Switch", "C) Wii", "D) PS2"],
                answer: "B"
            },
            {
                question: "En nombre de citations, Ã  quelle place se trouve Severus Rogue dans les romans Harry Potter ",
                options: ["A) 2", "B) 5", "C) 10", "D) 15"],
                answer: "B"
            },
            {
                question: "Quelle est la 15e ville la plus peuplÃ©e de France ?",
                options: ["A) Le Havre", "B) Metz", "C) Villeurbanne", "D) Viroflay"],
                answer: "A"
            },
            {
                question: "Selon Allocine, Ã  quel place se situe Your Name dans le classement des meilleurs films d'animation",
                options: ["A) 1", "B) 2", "C) 8", "D) Hors top 15 evidemment"],
                answer: "A"
            },
            {
                question: "Tojours selon Allocine, quelle est la meilleure sÃ©rie TV de tous les temps ?",
                options: ["A) Breaking bad", "B) Games of Thrones", "C) Peaky Blinders", "D) L'attaque des Titans"],
                answer: "A"
            },
            {
                question: "Quel est le prÃ©nom masculin le plus donnÃ© de tous les temps en France",
                options: ["A) ThaddÃ©e", "B) Pierre", "C) Michel", "D) Jean"],
                answer: "D"
            },
            {
                question: "Si la Tour Eiffel est le monument le plus photographiÃ© au monde, lequel est le 2e ?",
                options: ["A) le Louvre", "B) L'Empire State Building", "C) Big Ben", "D) Taj Mahal"],
                answer: "C"
            },
            {
                question: "Sachant que Honshu est la 8e plus grande ile au monde, laquelle est la 10e",
                options: ["A) Ile du Nprd (NZ)", "B) Madagascar", "C) Australie", "D) Grande Bretagne"],
                answer: "D"
            },
            {
                question: "Sachant que le Vollyeball est le 6e sport le plus populaire au monde, lequel est le 7e ?",
                options: ["A) Boxe", "B) Hockey sur gazon", "C) Tennis de Table", "D) Rugby"],
                answer: "C"
            },
            {
                question: "Quel est le 7e plus grand empire qui a existÃ©",
                options: ["A) Le califat omeyiade ", "B) Le califat omeyyiade ", "C) Le califat ommeyade ", "D)Le califat omeyyade "],
                answer: "D"
            }
        ];

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('userStatus').innerText = `Welcome: ${user.email}`;

                const userRef = doc(db, 'users', userId);
                const docSnap = await getDoc(userRef);

                if (!docSnap.exists()) {
                    await setDoc(userRef, { userId: userId, totalPlayCountGame6: 0, highestScoreGame6: 0 });
                    console.log("User document created with initial values.");
                } else {
                    const userData = docSnap.data();
                    totalPlayCountGame6 = userData.totalPlayCountGame6 || 0;
                    highestScore = userData.highestScoreGame6 || 0;
                    playCount = totalPlayCountGame6 + 1;
                    console.log(`Loaded totalPlayCountGame6: ${totalPlayCountGame6}, highestScore: ${highestScore}`);
                }
            } else {
                window.location.href = 'login.html';
            }
        });

        startBtn.addEventListener('click', async () => {
            score = 0;
            scoreDisplay.innerText = `Current Score: ${score}`;
            inputField.value = '';
            inputField.disabled = false;
            timerDisplay.innerText = '';
            optionsDisplay.innerHTML = '';

            // Increment totalPlayCount and update Firestore
            totalPlayCountGame6 += 1;
            await updateDoc(doc(db, 'users', userId), { totalPlayCountGame6: totalPlayCountGame6 });

            let questionIndex = 0;
            showQuestion(questionIndex);

            const timerDuration = 15;
            let timeLeft;

            function startTimer() {
                timeLeft = timerDuration;
                timerDisplay.innerText = `Temps restant: ${timeLeft}s`;

                const timer = setInterval(() => {
                    timeLeft -= 1;
                    timerDisplay.innerText = `Temps restant: ${timeLeft}s`;

                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        inputField.disabled = true; // Disable input after time runs out
                        checkAnswer(questionIndex, ''); // Check answer as incorrect if time is up
                        questionIndex++;
                        if (questionIndex < questions.length) {
                            showQuestion(questionIndex);
                        } else {
                            endGame();
                        }
                    }
                }, 1000);
                return timer; // Return timer reference for clearing if needed
            }

            let timer = startTimer(); // Start the timer for the first question

            inputField.addEventListener('keyup', (event) => {
                if (event.key === 'Enter' && inputField.value) {
                    clearInterval(timer); // Clear the current timer
                    checkAnswer(questionIndex, inputField.value.toUpperCase());
                    questionIndex++;
                    inputField.value = '';

                    if (questionIndex < questions.length) {
                        showQuestion(questionIndex);
                        timer = startTimer(); // Start the timer for the next question
                    } else {
                        endGame();
                    }
                }
            });
        });

        function showQuestion(index) {
            const question = questions[index];
            questionDisplay.innerText = question.question;
            optionsDisplay.innerHTML = question.options.join('<br>');
            timerDisplay.innerText = `Temps restant : 15s`;
            inputField.disabled = false;
            inputField.focus();
        }

        function checkAnswer(index, userAnswer) {
            if (userAnswer === questions[index].answer) {
                score += 5;
                scoreDisplay.innerText = `Score actuel: ${score}`;
                console.log("Correct Answer!");
            } else if (userAnswer !== '') {
                console.log("Incorrect Answer.");
            }
        }

        async function saveScore(score) {
            try {
                const gameData = { score: score, playCount: playCount, timestamp: new Date() };
                await addDoc(collection(db, 'users', userId, 'Game6'), gameData);

                const userRef = doc(db, 'users', userId);
                if (totalPlayCountGame6 <= 1 &&score > highestScore) {
                    highestScore = score;
                    await updateDoc(userRef, { highestScoreGame6: highestScore });
                }
                console.log("Score saved successfully.");
            } catch (error) {
                console.error("Error saving score:", error);
            }
        }

        async function endGame() {
            inputField.disabled = true;
            await saveScore(score); // Save the score at the end of the game
            console.log("Game Over. Final Score:", score);
            alert(`The quiz is over! Your final score is: ${score}`);
        }
    </script>
</body>
</html>
