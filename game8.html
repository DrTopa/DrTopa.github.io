=
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ce jeu intemporel de la calculatrice</title>
    <style>
        /* General body styling */
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: #ffebcd;
            background-image: url('https://www.transparenttextures.com/patterns/snow.png');
            margin: 0;
            overflow-y: auto;
        }

        /* Title styling */
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #1b5e20;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }

        /* User status */
        #userStatus {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
            color: #a23636;
        }

        /* Instructions */
        #instructions {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2em;
            color: #333;
            overflow-y: auto; 
            max-height: 400px; /* Set a maximum height */
        }

        /* Game Area */
        #gameArea {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 400px;
            background-color: #fff;
            border: 2px solid #b71c1c;
            border-radius: 12px;
        }

        /* Bird and obstacles */
        .bird {
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: #ff5722;
            border-radius: 50%;
        }

        .obstacle {
            position: absolute;
            width: 30px;
            background-color: #00695c;
        }

        /* Score */
        #score {
            font-size: 1.5em;
            margin: 10px;
            color: #1b5e20;
        }

        /* Start Button */
        #start-btn {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            background-color: #388e3c;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        #start-btn:hover {
            background-color: #2e7d32;
        }
    </style>
</head>
<body>
    <h1>Ce jeu intemporel de la calculatrice 🐦</h1>

    <!-- Instructions -->
    <div id="instructions">
        <p>Les pleurs et les reproches résonnaient dans la pièce. Le fameux « Moi j’ai pas très faim, mais je la mange juste pour voir ton seum » fusait de toutes parts, et nos cinq compères repartirent divisés comme jamais, mais unis malgré tout autour de cette référence partagée.</p>
<p>Topapa, un peu penaud, prit alors la parole en s’essuyant discrètement les coins de la bouche, couverts de restes de Nutella. « On a choke, » dit-il avec gravité. « C’était un test, les amis, pour voir notre unité… et on est tombé dedans. Il va falloir être plus solidaires la prochaine fois, repartir ensemble, sinon Noël est perdu. »</p>
<p>À peine ces mots prononcés, une trappe temporelle s’ouvrit sous leurs pieds, et voilà nos héros projetés de nombreuses années en arrière. En sortant de cette brume temporelle, Dudley éclata de rire en regardant RaseToiLaMoustache : « Regardez, lui, toujours pas de moustache ! Ça change pas ! »</p>
<p>« Meuahhaha, » répondit RaseToiLaMoustache d’un ton gêné, s’arrêtant net en entendant sa propre voix, qui muait soudainement, déraillant dans des tonalités improbables. Toute l’équipe explosa de rire.</p>
<p>« Solidarité ! » rappela Topapa, tentant de garder le sérieux. Il porta machinalement la main à son front et sentit… des cheveux ! Ses cheveux étaient là, encore épais et fiers. Plein d’espoir, Bébé Romain enleva son béret dans l'espoir d’un miracle capillaire, mais, hélas, rien n'avait changé pour lui. « On n’est pas remontés assez loin, visiblement… » soupira-t-il, résigné.</p>
<p>Ils avancèrent prudemment dans le dédale du passé, conscients que chaque jour perdu ici les retardait dans la préparation des cadeaux. Devant eux se dressaient trois portes, chacune portant une plaque avec un nom légendaire gravé : « Rome: Total War », « Age of Empires », et enfin, la troisième.</p>
<p>Bébé Romain se tourna vers ses camarades, levant un sourcil impressionné. « Bon, faut avouer, là, le codeur s’est surpassé. Allez, let’s go pour Rome: Total War ! » dit-il en poussant la première porte.</p>
<p>À peine avaient-ils franchi le seuil qu’un énorme 404 apparut sur les murs, clignotant dans une lumière rouge inquiétante. « Manque de skill, visiblement, » grogna Grinchémie en levant les yeux au ciel. « Ton Rome Total Chais-pas-quoi, là, je te le programme en cinq minutes avec Matplotlib, tkt. »</p>
<p>« Bon, essayons Age of Empires alors, » dit Bébé Romain, enthousiaste, en s’engouffrant dans la deuxième porte. Mais à nouveau, le même message 404 s’afficha de toutes parts.</p>
<p>Finalement, il leva les yeux vers la troisième porte, un peu inquiet de ce qui l’attendait : « Flappy Bird. »</p>
<p>Ils entrèrent avec précaution et virent aussitôt des oiseaux multicolores s’envoler de la pièce dans un tourbillon. « Refermez vite la porte, ils s’échappent ! » cria un homme en allemand. « Flappy, KOMM HIER NEIN NEIN ! »</p>
<p>Dudley observa le tout avec un air dédaigneux. « Encore un jeu du siècle dernier, franchement… »</p>
<p>Grinchémie lui lança un regard accusateur. « Bien sûr, tu n’as pas la référence, Dudley, c’est pour ça. Toi, tu es au collège, alors tu te contentes de ta calculatrice de collégien. » Elle insista lourdement sur le mot, dans l’espoir de provoquer une réaction.</p>
<p>Mais Dudley, un vétéran des piques de Grinchémie, savait désormais que sa force résidait dans l’ignorance. Il ne broncha pas, gardant le silence pour ne pas lui donner satisfaction.</p>
<p>« Tu vois Geometry Dash ? » continua Grinchémie « Eh bien, Flappy Bird, c’est pareil pour les anciens ! Sauf qu’on y jouait sur les calculatrices du lycée, à l’époque. »</p>
<p>Bébé Romain leva les bras en soupirant, l’air solennel. « Ah, tah l’époque » Mais cette expression sorti de sa bouche provoqua un sentiment de cringe certain. </p>
<p>Une fois à l’intérieur, ils aperçurent l’homme au chapeau qui les attendait au centre de la pièce, les bras croisés, entouré d’une volée d’oiseaux déjantés.</p>
<p>Dudley, le cœur battant, prit son courage à deux mains et décida d’avancer dans l’autre direction, appeuré par les potentiels reproches du paysan. L’homme s’approchait « Bienvenue dans Flappy Bird version Wish, » annonça-t-il d’une voix qui résonnait dans toute la salle.</p>
<p>Explication du jeu : Possible seulement sur ordinateur. Eviter les obstacles en appuyant sur la touche Espace. </p>
<p>Eviter les obstacles pour mettre des points. Votre score sera divisé par 50 et les points seront ajoutés au LeaderBoard. Vous avez 15 essais pour améliorer votre score.</p> 
<p>Attention, rester appuyé ne marche pas. Juste après avoir appuyé sur « Commencer le jeu », appuyer sur la barre Espace sinon c’est la chute directe. </p>
<p>Attention2 : Avant de cliquer sur « Commencer le Jeu » (pour rejouer), attendez que les obstacles soient passés, sinon le jeu va démarrer en prenant en compte les obstacles visibles. Mais vous allez comprendre. </p>
</p>
    </div>

    <div id="userStatus"></div>
    <div id="score">Score: 0</div>
    <button id="start-btn">Commencer le jeu</button>
    <div id="gameArea">
        <div id="bird" class="bird"></div>
    </div>

    <script defer type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC4bjg7lVwd8FU8MREaPhBsBENv5qmiYYM",
            authDomain: "calendrier-de-l-avent-54e3a.firebaseapp.com",
            databaseURL: "https://calendrier-de-l-avent-54e3a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "calendrier-de-l-avent-54e3a",
            storageBucket: "calendrier-de-l-avent-54e3a.appspot.com",
            messagingSenderId: "850639567855",
            appId: "1:850639567855:web:0d799a1ecca005fcff141a",
            measurementId: "G-PC1W7RYVEH"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = '';
        let score = 0;
        let highestScore = 0;
        let totalPlayCountGame8 = 0;
        let gameInterval, gravityInterval, obstacleInterval;
        const bird = document.getElementById('bird');
        const gameArea = document.getElementById('gameArea');
        const scoreDisplay = document.getElementById('score');
        const startButton = document.getElementById('start-btn');
        let birdY = 200;
        let velocity = 0;
        let obstacleSpeed = 3; // Initial speed for obstacles

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('userStatus').innerText = `Bienvenue : ${user.email}`;

                const userRef = doc(db, 'users', userId);
                const docSnap = await getDoc(userRef);

                if (!docSnap.exists()) {
                    await setDoc(userRef, { userId: userId, totalPlayCountGame8: 0, highestScoreGame8: 0 });
                } else {
                    const userData = docSnap.data();
                    totalPlayCountGame8 = userData.totalPlayCountGame8 || 0;
                    highestScore = userData.highestScoreGame8 || 0;
                }
            } else {
                window.location.href = 'login.html';
            }
        });

        function startGame() {
            score = 0;
            birdY = 200;
            velocity = 0;
            bird.style.top = `${birdY}px`;
            obstacleSpeed = 3; // Reset obstacle speed
            scoreDisplay.innerText = `Score: ${score}`;
            startButton.style.display = 'none';

            // Game loop for bird movement and gravity
            gameInterval = setInterval(updateGame, 20);
            gravityInterval = setInterval(() => velocity += 0.5, 30); // Slower gravity for easier gameplay

            // Generate obstacles every 1 second (increased frequency)
            obstacleInterval = setInterval(createDoubleObstacle, 1500);
        }

        function updateGame() {
            birdY += velocity;
            bird.style.top = `${birdY}px`;

            // Increase obstacle speed based on score
            obstacleSpeed = 1.5 + (score / 1000) * 3; // Increases speed from 3 to 6 based on score

            // Check if bird hits top or bottom boundaries
            if (birdY <= 0 || birdY >= gameArea.offsetHeight - bird.offsetHeight || checkCollision()) {
                endGame();
            } else {
                score += 1;
                scoreDisplay.innerText = `Score: ${score}`;
            }
        }

        function createObstacle() {
            const randomValue = Math.random();

            if (randomValue < 0) {
                // Create a top obstacle
                createSingleObstacle('top');
            } else if (randomValue < 0.) {
                // Create a bottom obstacle
                createSingleObstacle('bottom');
            } else {
                // Create both top and bottom obstacles
                createDoubleObstacle();
            }
        }

        function createSingleObstacle(position) {
            const obstacle = document.createElement('div');
            obstacle.classList.add('obstacle');

            const obstacleHeight = Math.random() * 100 + 80; // Random height for obstacles
            obstacle.style.height = `${obstacleHeight}px`;
            obstacle.style.width = '30px';
            obstacle.style.left = `${gameArea.offsetWidth}px`;

            if (position === 'top') {
                obstacle.style.top = '0';
            } else {
                obstacle.style.bottom = '0';
            }

            gameArea.appendChild(obstacle);

            // Move the obstacle across the game area
            const moveInterval = setInterval(() => {
                const obstacleLeft = parseInt(obstacle.style.left, 10);
                if (obstacleLeft < -30) {
                    gameArea.removeChild(obstacle);
                    clearInterval(moveInterval);
                } else {
                    obstacle.style.left = `${obstacleLeft - obstacleSpeed}px`;
                }
            }, 20);
        }

function createDoubleObstacle() {
    const topObstacle = document.createElement('div');
    const bottomObstacle = document.createElement('div');

    topObstacle.classList.add('obstacle');
    bottomObstacle.classList.add('obstacle');

    const gameAreaHeight = gameArea.offsetHeight;
    const minSpace = gameAreaHeight / 4;
    const minHeight = 10;

    const maxTopObstacleHeight = gameAreaHeight - minSpace - minHeight; // Adjusted max height for top obstacle
    const topObstacleHeight = Math.random() * (maxTopObstacleHeight - minHeight) + minHeight;

    // Calculate height for the bottom obstacle so that both have enough space and respect the minimum height constraint
    const bottomObstacleHeight = gameAreaHeight - topObstacleHeight - minSpace;


    topObstacle.style.height = `${topObstacleHeight}px`;
    bottomObstacle.style.height = `${bottomObstacleHeight}px`;
    topObstacle.style.width = '10px';
    bottomObstacle.style.width = '10px';
    topObstacle.style.left = `${gameArea.offsetWidth}px`;
    bottomObstacle.style.left = `${gameArea.offsetWidth}px`;

    topObstacle.style.top = '0';
    bottomObstacle.style.bottom = '0';

    gameArea.appendChild(topObstacle);
    gameArea.appendChild(bottomObstacle);

    const moveInterval = setInterval(() => {
        const topObstacleLeft = parseInt(topObstacle.style.left, 10);
        const bottomObstacleLeft = parseInt(bottomObstacle.style.left, 10);
        if (topObstacleLeft < -30) {
            gameArea.removeChild(topObstacle);
            gameArea.removeChild(bottomObstacle);
            clearInterval(moveInterval);
        } else {
            topObstacle.style.left = `${topObstacleLeft - obstacleSpeed}px`;
            bottomObstacle.style.left = `${bottomObstacleLeft - obstacleSpeed}px`;
        }
    }, 20);
}

        function checkCollision() {
            const obstacles = document.getElementsByClassName('obstacle');
            for (let obstacle of obstacles) {
                const birdRect = bird.getBoundingClientRect();
                const obstacleRect = obstacle.getBoundingClientRect();

                if (
                    birdRect.right > obstacleRect.left &&
                    birdRect.left < obstacleRect.right &&
                    birdRect.bottom > obstacleRect.top &&
                    birdRect.top < obstacleRect.bottom
                ) {
                    return true;
                }
            }
            return false;
        }

       async function endGame() {
            clearInterval(gameInterval);
            clearInterval(gravityInterval);
            clearInterval(obstacleInterval);
            await saveScore(score);
            alert(`Partie terminée! Votre score: ${score}`);
            startButton.style.display = 'block';
        }

        async function saveScore(currentScore) {
            try {
                const gameData = { score: currentScore,playCount: totalPlayCountGame8 + 1, timestamp: new Date() };
                await addDoc(collection(db, 'users', userId, 'Game8'), gameData);
                const userRef = doc(db, 'users', userId);
                
                if (totalPlayCountGame8 < 15 && currentScore > highestScore) {
                   highestScore = Math.ceil(currentScore / 50);
                    await updateDoc(doc(db, 'users', userId), { highestScoreGame8: highestScore });
                }
            totalPlayCountGame8 += 1;
            await updateDoc(userRef, { totalPlayCountGame8 });
            } catch (error) {
                console.error("Erreur en sauvegardant le score:", error);
            }
        }

        startButton.addEventListener('click', startGame);

        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') velocity = -4; // Press space to make bird jump
        });
    </script>
</body>
</html>
