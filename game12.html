<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŒŽGeoGuessr - Hardcore version - Jeu 12 ðŸŒŽ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: #ffebcd;
            background-image: url('https://www.transparenttextures.com/patterns/snow.png');
            margin: 0;
        }
        /* Christmas themed title */
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #d32f2f;
            font-family: 'Comic Sans MS', cursive;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }
        #userStatus {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
        }
                
        /* Instructions section */
        #instructions {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            text-align: center;
            max-width: 1000px;
            font-size: 1.2em;
            color: #333;
            overflow-y: auto;  /* Added for scrolling if needed */
            max-height: 300px; /* Set a maximum height */
        }
        #gameArea {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
        }
        #start-btn {
            padding: 10px 20px;
            margin: 10px;
            font-size: 1.5em;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            border: none;
        }
        #start-btn:hover {
            background-color: #0056b3;
        }

        #next-question-btn {
    padding: 10px 20px;
    margin: 10px;
    font-size: 1.5em;
    cursor: pointer;
    background-color: #007BFF;
    color: white;
    border: none;
    display: none; /* Keeps it hidden initially */
}

#next-question-btn:hover {
    background-color: #0056b3;
}
        
        #question {
            font-size: 1.5em;
            margin: 20px;
        }

        #timer, #score {
            font-size: 1.5em;
            margin: 10px;
        }
        #input {
            padding: 20px;
            font-size: 1.5em;
            margin: 10px;
            width: 100px;
        }

          .decoration {
    position: relative; /* Change to relative */
    display: flex; /* Use flexbox for centering */
    justify-content: center; /* Horizontally center */
    align-items: center; /* Vertically center */
    height: 100vh; /* Full viewport height to center */
    padding: 20px 0;
}

#santa {
    height: 400px;
    width: auto;
}
      
      

    </style>
</head>
<body>

    <h1>ðŸŒŽGeoGuessr - Hardcore version - Jeu 12 ðŸŒŽ</h1>
    <div id="userStatus"></div>
    
 <!-- Game instructions -->
    <div id="instructions">
        <p>La bouche encore pleine d'arlequins, BÃ©bÃ© Romain ferma l'ordinateur. Soudain, la ceinture magique de NoÃ«l fit son apparition, scintillante comme jamais. Â« Bien jouÃ©, les enfants ! Vous vous dÃ©brouillez trÃ¨s bien. Mais le chemin est encore long, Â» annonÃ§a-t-elle avec une voix chaleureuse.</p>
<p>Â« Ã‡a va Ãªtre le jeu du dictionnaire, câ€™est Ã§a la suite ? Â» rigola Dudley</p>
<p>Quelques secondes aprÃ¨s, alors que tout le monde Ã©tait assis, sauf Dudley â€” qui avait du mal Ã  sâ€™asseoir confortablement aprÃ¨s sa blague â€”, la ceinture magique ouvrit un nouveau portail. Les cinq compÃ¨res sâ€™y engagÃ¨rent avec curiositÃ©.</p>
<p>Ils se retrouvÃ¨rent sur un tapis un peu vieillot, devant un canapÃ© recouvert d'anciens draps. Un rocking chair grinÃ§ait doucement, et une Ã©norme radio ornÃ©e d'une tour de CD trÃ´nait dans un coin. Pas de doutes, ils Ã©taient au 17 rue du Colonel Fabien. Mais ce nâ€™Ã©tait pas en 2024. Le piano dans le salon confirmait quâ€™ils nâ€™Ã©taient pas dans le futur non plus.</p>
<p>Au fond de la piÃ¨ce, ils aperÃ§urent un homme avec la mÃªme coupe de cheveux que BÃ©bÃ© Romain. Ce dernier Ã©tait en train dâ€™Ã©crire un article pour Armenews. GrinchÃ©mie, curieuse de dÃ©couvrir sa caverne d'autrefois, fut surprise de revoir cet homme en train de peindre dans le couloir. En regardant par la fenÃªtre de sa chambre, elle le revit en train dâ€™enlever des mauvaises herbes dans le jardin. </p>
<p>Alors quâ€™elle se retourna, elle vit quâ€™il Ã©tait encore lÃ , souriant, en train de peindre dans le couloir. DÃ©sabusÃ©e, elle remonta dans le salon et elle lâ€™aperÃ§ut en train de siroter un thÃ© tout en consultant son smartphone Ã  la recherche dâ€™appartements Ã  Lyon, son ordinateur Ã©tant visiblement ralenti par quatre tÃ©lÃ©chargements en cours.</p>
<p>La ceinture magique de NoÃ«l remarqua lâ€™air de GrinchÃ©mie. Â« Câ€™est TÃ©lÃ©PAPArition, Â» annonÃ§a-t-elle avec un sourire malicieux, Â« trÃ¨s pratique quand il faut Ãªtre partout Ã  la fois. Â» </p>
<p>Pendant ce temps, Dudley fouilla autour de lui et trouva une boÃ®te remplie de petits drapeaux. Un dÃ©fi s'illumina dans son esprit. Â« HÃ©, RaseToiLaMoustache, tu veux te battre en duel ? Â» s'exclama-t-il, un sourire arrogant aux lÃ¨vres. </p>
<p>Mais le renne perdait lamentablement. Â« Meuhahaha ! Â» nâ€™Ã©tant pas un pays, il se retrouva souvent en difficultÃ©. Â« Quelquâ€™un dâ€™autre pour me dÃ©fier ? Â» lanÃ§a Dudley, lâ€™air hautain.</p>
<p> Explication du jeu : Trouver le pays en identifiant le drapeau, câ€™Ã©tait trop simple ? Ok, cette fois, vous devrez deviner le pays Ã  partir dâ€™une description du drapeau. Ah, on fait moins les malins lÃ , hein ? </p>
<p>Attention Ã  la syntaxe. On Ã©vite les accents dans les rÃ©ponses et les noms du pays sont uniquement en franÃ§ais. De mÃªme on Ã©vite les dÃ©terminants, câ€™est "belgique", et pas Â« la Belgique Â» ou toute autre variante. Vous pouvez Ã©crire en minuscules ou en majuscules, mais attention aux fautes : cela peut se jouer Ã  un caractÃ¨re.</p>
<p>Vous avez 60 secondes par drapeau pour rÃ©pondre. Mais le chrono ne s'arrÃ¨te pas en cas de mauvaises rÃ©ponses, donc tentez autant de fois que vous voulez tant que le chrono tourne.</p>
<p>Petit conseil : Ce jeu est coriace ! Prenez un papier et des crayons de couleur Ã  portÃ©e de main pour visualiser les drapeaux. De mÃªme, pour Ã©viter les contestations sur un pays mal Ã©crit, vous pouvez filmer votre tentative en cas de rÃ©clamation. Vous n'avez bien sÃ»r qu'un seul essai. Jeu possible sur Smartphone mais plus lisible sur ordinateur.</p>
    </div>
    <img id="santa" class="decoration" src="https://i.imgur.com/5jMzdIr.jpeg" alt="Santa Claus">
    
    <div id="gameArea">
        <button id="start-btn">ðŸŽ…Start GameðŸŽ…</button>
        <div id="timer"></div>
        <div id="score"></div>
        <button id="next-question-btn" style="display: none;">Prochaine question</button>
        <div id="question"></div>
        <input type="text" id="input" placeholder="RÃ©ponse" disabled>
      

      
    </div>

    <script defer type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4bjg7lVwd8FU8MREaPhBsBENv5qmiYYM",
            authDomain: "calendrier-de-l-avent-54e3a.firebaseapp.com",
            databaseURL: "https://calendrier-de-l-avent-54e3a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "calendrier-de-l-avent-54e3a",
            storageBucket: "calendrier-de-l-avent-54e3a.appspot.com",
            messagingSenderId: "850639567855",
            appId: "1:850639567855:web:0d799a1ecca005fcff141a",
            measurementId: "G-PC1W7RYVEH"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = '';
        let score = 0;
        let playCount = 0;
        let totalPlayCountGame12 = 0;
        let highestScore = 0;
        let questionIndex = 0;
        let timer; 

        const startBtn = document.getElementById('start-btn');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score');
        const questionDisplay = document.getElementById('question');
        const inputField = document.getElementById('input');
        const nextquestionbtn = document.getElementById('next-question-btn');


        const questions = [
            {
                 question: "Drapeau tricolore avec trois bandes verticales : Bleu, Blanc et Rouge",
                answer: ["France"], 
            },{
                 question: "Drapeau tricolore avec trois bandes horizontales : Rouge, Bleu et Orange",
                answer: ["Armenie", "ArmÃ©nie"], 
            },
            {
                 question: "Drapeau avec un fond blanc et un cercle rouge au centre.",
                answer: ["Japon"], 
            },{
                 question: "Drapeau composÃ© de trois bandes horizontales â€“ bleu clair, blanc, bleu clair â€“ avec un soleil jaune en plein centre de la bande blanche.",
                answer: ["Argentine"], 
            },{
                 question: "Drapeau composÃ© d'une Ã©toile et une lune blanche sur un fond vert foncÃ© avec une bande blanche Ã  sa gauche.",
                answer: ["Pakistan"], 
            },{
                 question: "Drapeau tricolore composÃ© de trois bandes horizontales : vert, blanc et rouge. Un aigle tenant un serpent au centre de la bande blanche",
                answer: ["Mexique"], 
            },{
                 question: "Drapeau tout rouge avec une Ã©toile jaune Ã  cinq branches en plein centre",
                answer: ["Vietnam","Viet Nam", "Viet-Nam", "ViÃªtnam"], 
            },{
                 question: "Sur fond vert clair, un losange jaune dans lequel on retrouve une sphÃ¨re bleu foncÃ©e remplie dâ€™Ã©toiles dans lequel on peut lire â€˜ordem et progressoâ€™",
                answer: ["Bresil", "BrÃ©sil"], 
            },{
                 question: "Un drapeau rectangulaire sÃ©parÃ© en 2 par la diagonale. La partie supÃ©rieure est jaune et celle du dessous est orange. Un dragon est situÃ© au centre du drapeau",
                answer: ["Bhoutan"], 
            },{
                 question: "Drapeau composÃ© de 5 bandes horizontales de taille diffÃ©rentes : une moyenne verte foncÃ©e, une petite blanche, une grande rouge, une petite blanche et une moyenne verte foncÃ©e. Au centre de la bande rouge, on retrouve une Ã©toile jaune Ã  5 branches.",
                answer: ["Suriname"], 
            },{
                 question: "Drapeau composÃ© de deux bandes verticales vert foncÃ© et blanc avec un croissant et une Ã©toile rouge au milieu",
                answer: ["Algerie","AlgÃ©rie"], 
            },{
                 question: "Drapeau tricolore composÃ© de trois bandes horizontales. Rouge, jaune et vert foncÃ©e avec une Ã©toile noire en son centre.",
                answer: ["Ghana"], 
            },{
                 question: "Drapeau tricolore avec trois bandes horizontales : Noire, Rouge et Jaune",
                answer: ["Allemagne"], 
            },{
                 question: "Drapeau bleu foncÃ© avec une fine bande centrale horizontale jaune. En dessous de la bande, on retrouve un soleil blanc",
                answer: ["Nauru"], 
            },{
                 question: "Drapeau blanc avec deux larges bandes bleues foncÃ©es .La premiÃ¨re traverse le drapeau horizontalement en son centre et la deuxiÃ¨me verticalement au niveau du 1er tier du drapeau, le tout formant une croix. ",
                answer: ["Finlande"], 
            },{
                 question: "Drapeau tricolore composÃ© de trois bandes horizontales : rouge, blanc, rouge avec un cÃ¨dre dans la partie blanche qui est un peu plus grande que les deux autres.",
                answer: ["Liban"], 
            },{
                 question: "Drapeau tricolore horizontale rouge, blanc et noir avec deux Ã©toiles vertes au centre",
                answer: ["Syrie"], 
            },{
                 question: "Drapeau tricolore avec trois bandes horizontales : Rouge, Jaune et Verte",
                answer: ["Bolivie"], 
            },{
                 question: "Drapeau bicolore avec trois bandes verticale avec 3 bandes verticales rouge, blanc et rouge. Il y a une feuille dâ€™ Ã©rable rouge dans la partie blanche",
                answer: ["Canada"], 
            },{
                 question: " Drapeau constituÃ© de 3 bandes horizontales: noire , rouge (bordÃ©e en haut et en bas par une petite bande blanche) et verte.Au centre, prÃ©sence dâ€™un bouclier rouge couvrant deux lances blanches pointant vers le haut. ",
                answer: ["Kenya"], 
            }
            
        ];

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('userStatus').innerText = `Welcome: ${user.email}`;

                const userRef = doc(db, 'users', userId);
                const docSnap = await getDoc(userRef);

                if (!docSnap.exists()) {
                    await setDoc(userRef, { userId: userId, totalPlayCountGame12: 0, highestScoreGame12: 0 });
                    console.log("User document created with initial values.");
                } else {
                    const userData = docSnap.data();
                    totalPlayCountGame12 = userData.totalPlayCountGame12 || 0;
                    highestScore = userData.highestScoreGame12 || 0;
                    playCount = totalPlayCountGame12 + 1;
                    console.log(`Loaded totalPlayCountGame12: ${totalPlayCountGame12}, highestScore: ${highestScore}`);
                }
            } else {
                window.location.href = 'login.html';
            }
        });

startBtn.addEventListener('click', async () => {
    score = 0;
    scoreDisplay.innerText = `Current Score: ${score}`;
    inputField.value = '';
    inputField.disabled = false;
    timerDisplay.innerText = '';

    // Increment totalPlayCount and update Firestore
    totalPlayCountGame12 += 1;
    await updateDoc(doc(db, 'users', userId), { totalPlayCountGame12: totalPlayCountGame12 });

    questionIndex = 0;
    showQuestion(questionIndex);

    timer = startTimer(); // Start the timer for the first question

    inputField.addEventListener('keyup', (event) => {
        if (event.key === 'Enter' && inputField.value) {
            checkAnswer(questionIndex, inputField.value.toUpperCase());
            inputField.value = '';

        }
    });
});
document.getElementById('next-question-btn').addEventListener('click', () => {
    questionIndex++;
    if (questionIndex < questions.length) {
        showQuestion(questionIndex);
        startTimer();
        document.getElementById('next-question-btn').style.display = 'none'; // Hide the button again
    } else {
        endGame();
    }
});
      
function startTimer() {
    let timeLeft = 60; // Set time left for each question
    timerDisplay.innerText = `Temps restant: ${timeLeft}s`;

    clearInterval(timer);
    timer = setInterval(() => {
        timeLeft -= 1;
        timerDisplay.innerText = `Temps restant: ${timeLeft}s`;

        if (timeLeft <= 0) {
            const correctAnswers = questions[questionIndex].answer;
            clearInterval(timer);
            questionDisplay.innerHTML += `<br><strong>RÃ©ponse correcte : ${correctAnswers.join(', ')}</strong>`;
            inputField.disabled = true; // Disable input after time runs out
            checkAnswer(questionIndex, ''); // Check answer as incorrect if time is up
           document.getElementById('next-question-btn').style.display = 'inline'; // Show "Next Question" button
            
        }
    }, 1000);

    return timer; // Return timer reference for clearing if needed
}


function showQuestion(index) {
    clearInterval(timer);
    const question = questions[index];
    questionDisplay.innerText = question.question;
    timerDisplay.innerText = `Temps restant : 60s`;
    inputField.disabled = false;
    inputField.focus();
    timer = startTimer();
}

        function checkAnswer(index, userAnswer) {
            const correctAnswers = questions[index].answer;
            userAnswer = userAnswer.trim().toLowerCase();
            
             if (correctAnswers.some(answer => answer.toLowerCase() === userAnswer)) {
                score += 5;
                scoreDisplay.innerText = `Score actuel: ${score}`;
                console.log("Correct Answer!");
                clearInterval(timer);
                questionDisplay.innerHTML += `<br><strong>RÃ©ponse correcte : ${correctAnswers.join(', ')}</strong>`;
                inputField.disabled = true;
                document.getElementById('next-question-btn').style.display = 'inline'; // Show "Next Question" button
            
             } else if (userAnswer !== '') {
                console.log("Incorrect Answer.");
            }

        }

        async function saveScore(score) {
            try {
                const gameData = { score: score, playCount: playCount, timestamp: new Date() };
                await addDoc(collection(db, 'users', userId, 'Game12'), gameData);

                const userRef = doc(db, 'users', userId);
                if (totalPlayCountGame12 <= 1 &&score > highestScore) {
                    highestScore = score;
                    await updateDoc(userRef, { highestScoreGame12: highestScore });
                }
                console.log("Score saved successfully.");
            } catch (error) {
                console.error("Error saving score:", error);
            }
        }

        async function endGame() {
            inputField.disabled = true;
            await saveScore(score); // Save the score at the end of the game
            console.log("Game Over. Final Score:", score);
            alert(`Le quiz est fini! Wow t'avais vraiment pas la ref! Ton score final est: ${score}`);
        }
    </script>
</body>
</html>
