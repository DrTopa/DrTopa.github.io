<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game 2 - Quiz Challenge</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            overflow: hidden; /* Prevents scrollbars from appearing */
            position: relative; /* Needed for positioning snowflakes */
        }

        h1 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        #userStatus {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
        }

        #explanation {
            font-size: 1.2em;
            margin: 20px 0;
            padding: 10px;
            color: #333;
            max-width: 80%;
            text-align: center;
            line-height: 1.5;
            border-left: 4px solid #007BFF;
            background-color: #e0f2ff;
            border-radius: 8px;
        }

        #gameArea {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
            position: relative;
            z-index: 1; /* Ensure game area is above snowflakes */
        }

        #start-btn {
            padding: 10px 20px;
            margin: 10px;
            font-size: 1.5em;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            border: none;
        }

        #start-btn:hover {
            background-color: #0056b3;
        }

        #question {
            font-size: 1.5em;
            margin: 20px;
        }

        #options {
            font-size: 1.2em;
            margin: 10px;
        }

        #timer, #score {
            font-size: 1.5em;
            margin: 10px;
        }

        #input {
            padding: 10px;
            font-size: 1.2em;
            margin: 10px;
            width: 50px;
        }

        /* Snowflake CSS */
        .snowflake {
            position: absolute;
            top: -10px;
            color: white;
            font-size: 1em;
            opacity: 0.8;
            pointer-events: none; /* Prevents interaction with snowflakes */
        }

    </style>
</head>
<body>

    <h1>Quiz Challenge - Game 2</h1>
    <div id="userStatus"></div>
    
    <div id="explanation">
        Good morning, fellows! I will explain the rules to you. This quiz has a few questions, each with multiple-choice answers. 
        For each correct answer, you earn points. Good luck and have fun!
    </div>
    
    <div id="gameArea">
        <button id="start-btn">Start Game</button>
        <div id="timer"></div>
        <div id="score"></div>
        <div id="question"></div>
        <div id="options"></div>
        <input type="text" id="input" placeholder="A/B/C/D" maxlength="1" disabled>
    </div>

    <script defer type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4bjg7lVwd8FU8MREaPhBsBENv5qmiYYM",
            authDomain: "calendrier-de-l-avent-54e3a.firebaseapp.com",
            databaseURL: "https://calendrier-de-l-avent-54e3a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "calendrier-de-l-avent-54e3a",
            storageBucket: "calendrier-de-l-avent-54e3a.appspot.com",
            messagingSenderId: "850639567855",
            appId: "1:850639567855:web:0d799a1ecca005fcff141a",
            measurementId: "G-PC1W7RYVEH"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = '';
        let score = 0;
        let playCount = 0;
        let totalPlayCountGame2 = 0;
        let highestScore = 0;

        const startBtn = document.getElementById('start-btn');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score');
        const questionDisplay = document.getElementById('question');
        const optionsDisplay = document.getElementById('options');
        const inputField = document.getElementById('input');

        const questions = [
            {
                question: "Niveau 3e (2024) : Si je multiplie deux nombres pairs alors j'obtiens un nombre ..",
                options: ["A) Pair", "B) Impair", "C) Complexe", "D) Quoicoubeix"],
                answer: "A"
            },
            {
                question: "Niveau 3e (2024) : 8 * 7 = ?",
                options: ["A) 54", "B) 45", "C) 56", "D) 87"],
                answer: "C"
            },
            {
                question: "Niveau 3e (2024) : Quel nombre est plus petit que 17 ?",
                options: ["A) 1881/99", "B) 7²/2", "C) 18", "D) 16"],
                answer: "D"
            },
            {
                question: "Niveau 2nd (2024) : A combien est égal la racine de 9 ?",
                options: ["A) 3", "B) -3", "C) 3 et -3", "D) Gnia Gnia, tu sais pas faire la forme racine en HTML"],
                answer: "A"
            },
            {
                question: "Niveau 2nd (2024) A quel théorème peut-on associer cette phrase : Dans tout triangle rectangle, le carré de la longueur de l'hypoténuse est égal à la somme des carrés des longueurs des deux autres côtés.",
                options: ["A) Thalès", "B) Pythagore", "C) Venn-Pearson", "D) A.Topalian"],
                answer: "B"
            },
            {
                question: "Niveau 2nd (2024) A quel théorème peut-on associer cette phrase : Si deux droites sont parallèles et coupées par deux sécantes, alors les rapports des segments déterminés sur ces sécantes sont égaux.",
                options: ["A) Thalès", "B) Pythagore", "C) Venn-Pearson", "D) A.Topalian"],
                answer: "A"
            },
            {
                question: "Niveau 1er (2024) : Quelle est la formule d'une volume d'une sphère",
                options: ["A) πr² ", "B) (4πr^3)/3", "C) (2πr^3)/3", "D) (4πr^2)"],
                answer: "B"
            },
            {
                question: "Niveau Terminale (2024) : Si sin (60°) = X, quelle est la valeur de X ",
                options: ["A) 0.5", "B) (3^0.5)/3", "C) (2^0.5)/2", "D) (3^0.5)*0.5"],
                answer: "D"
            },
            {
                question: "Niveau Terminale (2024) : Paul a 8 pommes, Alfred en mange 2. Combien Alfred en a t-il mangé? ",
                options: ["A) 2", "B) 4", "C) 6", "D) 8"],
                answer: "A"
            },
            {
                question: "Niveau Terminale (2024) : Quelle est la bonne orthographe de cette inégalité (en français) ?",
                options: ["A) Bienaimé-Tchebychev", "B) Bienaymé-Tchebychev", "C) Bienaimé-Tchbeichev", "D) Bienaimé-Tchebychev"],
                answer: "B"
            }
        ];

        let currentQuestionIndex = 0;
        let timer;
        let timeLimit = 30; // 30 seconds per question

        // Function to update user status
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('userStatus').textContent = `Bienvenue, ${user.email}`;
                checkUserStats();
            } else {
                document.getElementById('userStatus').textContent = 'Vous n\'êtes pas connecté.';
            }
        });

        // Function to start the game
        startBtn.addEventListener('click', () => {
            score = 0;
            playCount++;
            currentQuestionIndex = 0;
            scoreDisplay.textContent = `Score: ${score}`;
            inputField.value = '';
            inputField.disabled = false;
            startBtn.disabled = true;
            startTimer();
            showQuestion();
        });

        // Function to start timer
        function startTimer() {
            timerDisplay.textContent = `Temps restant: ${timeLimit} secondes`;
            timer = setInterval(() => {
                timeLimit--;
                timerDisplay.textContent = `Temps restant: ${timeLimit} secondes`;
                if (timeLimit <= 0) {
                    clearInterval(timer);
                    alert('Temps écoulé !');
                    endGame();
                }
            }, 1000);
        }

        // Function to show current question
        function showQuestion() {
            const currentQuestion = questions[currentQuestionIndex];
            questionDisplay.textContent = currentQuestion.question;
            optionsDisplay.innerHTML = '';
            currentQuestion.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.addEventListener('click', () => checkAnswer(option.charAt(0)));
                optionsDisplay.appendChild(button);
            });
        }

        // Function to check answer
        function checkAnswer(selectedOption) {
            const currentQuestion = questions[currentQuestionIndex];
            if (selectedOption === currentQuestion.answer) {
                score++;
                scoreDisplay.textContent = `Score: ${score}`;
            }
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                timeLimit = 30; // Reset timer
                showQuestion();
            } else {
                endGame();
            }
        }

        // Function to end game
        function endGame() {
            clearInterval(timer);
            alert(`Jeu terminé ! Votre score est: ${score}`);
            saveUserStats();
            resetGame();
        }

        // Function to reset game
        function resetGame() {
            startBtn.disabled = false;
            inputField.disabled = true;
            questionDisplay.textContent = '';
            optionsDisplay.innerHTML = '';
            timerDisplay.textContent = '';
        }

        // Function to check user statistics
        async function checkUserStats() {
            const docRef = doc(db, 'users', userId);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                totalPlayCountGame2 = docSnap.data().totalPlayCountGame2 || 0;
                highestScore = docSnap.data().highestScore || 0;
            }
        }

        // Function to save user statistics
        async function saveUserStats() {
            const docRef = doc(db, 'users', userId);
            await updateDoc(docRef, {
                totalPlayCountGame2: totalPlayCountGame2 + playCount,
                highestScore: Math.max(highestScore, score)
            });
        }

        // Snowflake generation
        const snowflakeCount = 100; // Number of snowflakes
        const snowflakeContainer = document.createElement('div');
        document.body.appendChild(snowflakeContainer);

        for (let i = 0; i < snowflakeCount; i++) {
            const snowflake = document.createElement('div');
            snowflake.classList.add('snowflake');
            snowflake.textContent = '❄️'; // Unicode snowflake character
            snowflake.style.left = Math.random() * window.innerWidth + 'px';
            snowflake.style.fontSize = Math.random() * 20 + 10 + 'px'; // Random size
            snowflakeContainer.appendChild(snowflake);

            // Animate snowflakes
            animateSnowflake(snowflake);
        }

        function animateSnowflake(snowflake) {
            const fallDuration = Math.random() * 5 + 5; // Random fall duration
            const leftPosition = parseFloat(snowflake.style.left);
            const endPosition = leftPosition + (Math.random() * 100 - 50); // Random drift

            snowflake.animate([
                { transform: `translateY(0)` },
                { transform: `translateY(${window.innerHeight + 100}px)`, left: `${endPosition}px` }
            ], {
                duration: fallDuration * 1000,
                iterations: Infinity,
                easing: 'linear'
            });
        }
    </script>
</body>
</html>
