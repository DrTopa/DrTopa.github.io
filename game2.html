<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas Quiz Challenge - Game 2</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            background-color: #ffebcd; /* Light beige background */
            margin: 0;
            background-image: url('https://www.transparenttextures.com/patterns/snow.png');
            background-size: cover;
            color: #4a4a4a; /* Darker text for contrast */
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #c0392b; /* Christmas red */
        }
        #userStatus {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
            color: #2c3e50; /* Dark blue */
        }
        /* Instructions section */
        #instructions {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            text-align: center;
            max-width: 1000px;
            font-size: 1.2em;
            color: #333;
            overflow-y: auto;  /* Added for scrolling if needed */
            max-height: 300px; /* Set a maximum height */
        }
        #gameArea {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
            border: 2px solid #c0392b; /* Christmas red border */
            border-radius: 12px;
            padding: 20px;
            background-color: white; /* White background for the game area */
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        #start-btn {
            padding: 10px 20px;
            margin: 10px;
            font-size: 1.5em;
            cursor: pointer;
            background-color: #c0392b; /* Christmas red */
            color: white;
            border: none;
            border-radius: 5px;
        }
        #start-btn:hover {
            background-color: #e74c3c; /* Lighter red on hover */
        }
        #question {
            font-size: 1.5em;
            margin: 20px;
        }
        #options {
            font-size: 1.2em;
            margin: 10px;
        }
        #timer, #score {
            font-size: 1.5em;
            margin: 10px;
        }
        #input {
            padding: 10px;
            font-size: 1.2em;
            margin: 10px;
            width: 50px;
            border-radius: 5px;
            border: 1px solid #ccc; /* Light grey border */
        }
        /* Snowfall Animation */
        .snowflake {
            position: absolute;
            color: white;
            font-size: 1em;
            pointer-events: none;
            animation: snow 10s linear infinite;
        }
        @keyframes snow {
            0% { transform: translateY(0); }
            100% { transform: translateY(100vh); }
        }
    </style>
</head>
<body>

    <h1>ðŸŽ„ Christmas Quiz Challenge - Game 2 ðŸŽ„</h1>
    <div id="userStatus"></div>
    
    <!-- Game instructions -->
    <div id="instructions">
        <p>DÃ©cembre est enfin lÃ , et cela ne peut signifier quâ€™une chose : lâ€™atelier du PÃ¨re NoÃ«l Adrien, que tout le monde appelle Topapa, est en effervescence. FidÃ¨le Ã  sa rÃ©putation, Topapa sâ€™enfile une grande tasse de cafÃ©. "Elle a meilleur goÃ»t quand c'est l'autre Dudley qui me la prÃ©pare" se dit-il et puis il s'Ã©lance dans lâ€™atelier pour rÃ©veiller ses lutins. Ces derniers, encore en pyjama, sâ€™Ã©tirent maladroitement alors que Topapa secoue une vieille ceinture de cuir devant eux.</p>
        <p>Â« Allez, allez ! Au boulot, petits fainÃ©ants ! Â» dit-il dâ€™une voix joviale.</p>
        <p>Soudain, un cri fluet se fait entendre : Â« Graoumpfâ€¦ Â» Les bÃ©bÃ©s Romain, encore enroulÃ©s dans leurs couvertures, ouvrent un Å“il en fronÃ§ant leur gros sourcil, perturbÃ©s dans leur douce sieste. Tout endormis, ils tentent dâ€™appuyer en vain sur le bouton Snooze de leur rÃ©veil, espÃ©rant grappiller quelques minutes de sommeil supplÃ©mentaires. Mais leurs petites mains glissent et ratent Ã  chaque tentative, provoquant des petits bruits de frustration.</p>
        <p>Topapa, amusÃ©, dÃ©cide d'intervenir pour motiver ses petits nains : Â« Allez, allez, les nains ! On enfile les chaussures de sÃ©curitÃ©. DÃ©cembre ne va pas attendre que vous vous rÃ©veilliez ! Â»</p>
        <p>Explication jeu : Vous avez 4 essais pour amÃ©liorer votre score. AprÃ¨s avoir lancÃ© le jeu, appuyer sur le bouton Snooze le plus de fois possibles en 10 secondes. AprÃ¨s 4 essais, vous pourrez toujours jouer Ã  ce jeu passionnant.</p>
        <p>Possible sur Smartphone comme sur ordinateur. Peut-Ãªtre un mode est-il mieux quâ€™un autre.</p>
    </div>
    
    <div id="gameArea">
        <button id="start-btn">ðŸŽ… Start Game ðŸŽ…</button>
        <div id="timer"></div>
        <div id="score"></div>
        <div id="question"></div>
        <div id="options"></div>
        <input type="text" id="input" placeholder="A/B/C/D" maxlength="1" disabled>
    </div>

    <script defer type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4bjg7lVwd8FU8MREaPhBsBENv5qmiYYM",
            authDomain: "calendrier-de-l-avent-54e3a.firebaseapp.com",
            databaseURL: "https://calendrier-de-l-avent-54e3a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "calendrier-de-l-avent-54e3a",
            storageBucket: "calendrier-de-l-avent-54e3a.appspot.com",
            messagingSenderId: "850639567855",
            appId: "1:850639567855:web:0d799a1ecca005fcff141a",
            measurementId: "G-PC1W7RYVEH"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = '';
        let score = 0;
        let playCount = 0;
        let totalPlayCountGame2 = 0;
        let highestScore = 0;

        const startBtn = document.getElementById('start-btn');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score');
        const questionDisplay = document.getElementById('question');
        const optionsDisplay = document.getElementById('options');
        const inputField = document.getElementById('input');

        const questions = [
            {
                question: "Niveau 3e (2024) : Si je multiplie deux nombres pairs alors j'obtiens un nombre ..",
                options: ["A) Pair", "B) Impair", "C) Complexe", "D) Quoicoubeix"],
                answer: "A"
            },
            {
                question: "Niveau 3e (2024) : 8 * 7 = ?",
                options: ["A) 54", "B) 45", "C) 56", "D) 87"],
                answer: "C"
            },
            {
                question: "Niveau 3e (2024) : Quel nombre est plus petit que 17 ?",
                options: ["A) 1881/99", "B) 7Â²/2", "C) 18", "D) 16"],
                answer: "D"
            },
            {
                question: "Niveau 2nd (2024) : A combien est Ã©gal la racine de 9 ?",
                options: ["A) 3", "B) -3", "C) 3 et -3", "D) Gnia Gnia, tu sais pas faire la forme racine en HTML"],
                answer: "A"
            },
            {
                question: "Niveau 2nd (2024) A quel thÃ©orÃ¨me peut-on associer cette phrase : Dans tout triangle rectangle, le carrÃ© de la longueur de l'hypotÃ©nuse est Ã©gal Ã  la somme des carrÃ©s des longueurs des deux autres cÃ´tÃ©s.",
                options: ["A) ThalÃ¨s", "B) Pythagore", "C) Venn-Pearson", "D) A.Topalian"],
                answer: "B"
            },
            {
                question: "Niveau 2nd (2024) A quel thÃ©orÃ¨me peut-on associer cette phrase : Si deux droites sont parallÃ¨les et coupÃ©es par deux sÃ©cantes, alors les rapports des segments dÃ©terminÃ©s sur ces sÃ©cantes sont Ã©gaux.",
                options: ["A) ThalÃ¨s", "B) Pythagore", "C) Venn-Pearson", "D) A.Topalian"],
                answer: "A"
            },
            {
                question: "Niveau 1er (2024) : Quelle est la formule d'une volume d'une sphÃ¨re",
                options: ["A) Ï€rÂ² ", "B) (4Ï€r^3)/3", "C) (2Ï€r^3)/3", "D) (4Ï€r^2)"],
                answer: "B"
            },
            {
                question: "Niveau Terminale (2024) : Si sin (60Â°) = X, quelle est la valeur de X ",
                options: ["A) âˆš3/2", "B) 1/2", "C) âˆš2", "D) 0"],
                answer: "A"
            },
            {
                question: "Niveau Terminale (2024) : Quelle est la formule de la surface d'une sphÃ¨re",
                options: ["A) 4Ï€rÂ²", "B) 2Ï€r", "C) 4Ï€r^3", "D) Ï€rÂ²"],
                answer: "A"
            }
        ];

        let currentQuestionIndex = 0;
        let timer;
        let timeRemaining = 30; // seconds

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('userStatus').textContent = `Logged in as: ${user.email}`;
                await loadHighestScore();
            } else {
                document.getElementById('userStatus').textContent = 'Not logged in.';
            }
        });

        startBtn.addEventListener('click', startGame);

        async function loadHighestScore() {
            const docRef = doc(db, "players", userId);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                highestScore = docSnap.data().highestScoreGame2 || 0;
                scoreDisplay.textContent = `Your highest score is ${highestScore}.`;
            }
        }

        function startGame() {
            score = 0;
            currentQuestionIndex = 0;
            totalPlayCountGame2++;
            inputField.value = '';
            inputField.disabled = false;
            scoreDisplay.textContent = `Score: ${score}`;
            startBtn.disabled = true;
            nextQuestion();
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length) {
                const currentQuestion = questions[currentQuestionIndex];
                questionDisplay.textContent = currentQuestion.question;
                optionsDisplay.innerHTML = currentQuestion.options.map((option) => `<div>${option}</div>`).join('');
                timeRemaining = 30;
                startTimer();
            } else {
                endGame();
            }
        }

        function startTimer() {
            timerDisplay.textContent = `Time Remaining: ${timeRemaining}`;
            timer = setInterval(() => {
                timeRemaining--;
                timerDisplay.textContent = `Time Remaining: ${timeRemaining}`;
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    inputField.disabled = true;
                    nextQuestion();
                }
            }, 1000);
        }

        inputField.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checkAnswer(inputField.value.toUpperCase());
            }
        });

        function checkAnswer(selectedOption) {
            clearInterval(timer);
            inputField.disabled = true;

            const currentQuestion = questions[currentQuestionIndex];
            if (selectedOption === currentQuestion.answer) {
                score++;
            }
            currentQuestionIndex++;
            scoreDisplay.textContent = `Score: ${score}`;
            nextQuestion();
        }

        function endGame() {
            inputField.disabled = true;
            startBtn.disabled = false;
            if (score > highestScore) {
                highestScore = score;
                await updateScoreInDB();
            }
            scoreDisplay.textContent += ` Your final score is ${score}.`;
            questionDisplay.textContent = 'Game Over! ðŸŽ‰';
            optionsDisplay.innerHTML = '';
        }

        async function updateScoreInDB() {
            const docRef = doc(db, "players", userId);
            await updateDoc(docRef, {
                highestScoreGame2: highestScore,
                totalPlayCountGame2: totalPlayCountGame2
            });
        }
    </script>
</body>
</html>


